<script>
<!--
document.write(unescape("%3Cscript%3E%0A%20%20document.write%28atob%28%22PCFET0NUWVBFIGh0bWw+Cgo8aHRtbCBsYW5nPSJlbiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiPgoKPGhlYWQ+Cgk8c2NyaXB0PgoJCShmdW5jdGlvbiAocm9vdCwgbmFtZSwgZmFjdG9yeSkgewogICd1c2Ugc3RyaWN0JzsKICB2YXIgb2JqZWN0VHlwZXMgPSB7CiAgICAgICdmdW5jdGlvbic6IHRydWUsCiAgICAgICdvYmplY3QnOiB0cnVlCiAgICB9LAogICAgZnJlZUV4cG9ydHMgPSBvYmplY3RUeXBlc1t0eXBlb2YgZXhwb3J0c10gJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzLAogICAgZnJlZU1vZHVsZSA9IG9iamVjdFR5cGVzW3R5cGVvZiBtb2R1bGVdICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZSwKICAgIGZyZWVHbG9iYWwgPSBmcmVlRXhwb3J0cyAmJiBmcmVlTW9kdWxlICYmIHR5cGVvZiBnbG9iYWwgPT09ICdvYmplY3QnICYmIGdsb2JhbCwKICAgIG1vZHVsZUV4cG9ydHMgPSBmcmVlTW9kdWxlICYmIGZyZWVNb2R1bGUuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHMgJiYgZnJlZUV4cG9ydHM7CiAgaWYgKGZyZWVHbG9iYWwgJiYgKGZyZWVHbG9iYWwuZ2xvYmFsID09PSBmcmVlR2xvYmFsIHx8CiAgICAgIGZyZWVHbG9iYWwud2luZG93ID09PSBmcmVlR2xvYmFsIHx8CiAgICAgIGZyZWVHbG9iYWwuc2VsZiA9PT0gZnJlZUdsb2JhbCkpIHsKICAgIHJvb3QgPSBmcmVlR2xvYmFsOwogIH0KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJgogICAgdHlwZW9mIGRlZmluZS5hbWQgPT09ICdvYmplY3QnICYmCiAgICBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoWydleHBvcnRzJ10sIGZhY3RvcnkpOwogICAgaWYgKGZyZWVFeHBvcnRzICYmIG1vZHVsZUV4cG9ydHMpIGZhY3RvcnkoZnJlZU1vZHVsZS5leHBvcnRzKTsKICB9IGVsc2UKICBpZiAoZnJlZUV4cG9ydHMgJiYgZnJlZU1vZHVsZSkgewogICAgaWYgKG1vZHVsZUV4cG9ydHMpIGZhY3RvcnkoZnJlZU1vZHVsZS5leHBvcnRzKTsKICAgIGVsc2UgZmFjdG9yeShmcmVlRXhwb3J0cyk7CiAgfSBlbHNlIHsKICAgIGZhY3RvcnkoKHJvb3RbbmFtZV0gPSB7fSkpOwogIH0KfSh0aGlzLCAnbHVhcGFyc2UnLCBmdW5jdGlvbiAoZXhwb3J0cykgewogICd1c2Ugc3RyaWN0JzsKCiAgZXhwb3J0cy52ZXJzaW9uID0gJzAuMi4xJzsKCiAgdmFyIGlucHV0LCBvcHRpb25zLCBsZW5ndGgsIGZlYXR1cmVzLCBlbmNvZGluZ01vZGU7CiAgdmFyIGRlZmF1bHRPcHRpb25zID0gZXhwb3J0cy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgIHdhaXQ6IGZhbHNlLAogICAgY29tbWVudHM6IHRydWUsCiAgICBzY29wZTogZmFsc2UsCiAgICBsb2NhdGlvbnM6IGZhbHNlLAogICAgcmFuZ2VzOiBmYWxzZSwKICAgIG9uQ3JlYXRlTm9kZTogbnVsbCwKICAgIG9uQ3JlYXRlU2NvcGU6IG51bGwsCiAgICBvbkRlc3Ryb3lTY29wZTogbnVsbCwKICAgIG9uTG9jYWxEZWNsYXJhdGlvbjogbnVsbCwKICAgIGx1YVZlcnNpb246ICc1LjEnLAogICAgZW5jb2RpbmdNb2RlOiAnbm9uZScKICB9OwoKICBmdW5jdGlvbiBlbmNvZGVVVEY4KGNvZGVwb2ludCwgaGlnaE1hc2spIHsKICAgIGhpZ2hNYXNrID0gaGlnaE1hc2sgfHwgMDsKCiAgICBpZiAoY29kZXBvaW50IDwgMHg4MCkgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlcG9pbnQpOwogICAgfSBlbHNlIGlmIChjb2RlcG9pbnQgPCAweDgwMCkgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgKICAgICAgICBoaWdoTWFzayB8IDB4YzAgfCAoY29kZXBvaW50ID4+IDYpLAogICAgICAgIGhpZ2hNYXNrIHwgMHg4MCB8IChjb2RlcG9pbnQgJiAweDNmKQogICAgICApOwogICAgfSBlbHNlIGlmIChjb2RlcG9pbnQgPCAweDEwMDAwKSB7CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKAogICAgICAgIGhpZ2hNYXNrIHwgMHhlMCB8IChjb2RlcG9pbnQgPj4gMTIpLAogICAgICAgIGhpZ2hNYXNrIHwgMHg4MCB8ICgoY29kZXBvaW50ID4+IDYpICYgMHgzZiksCiAgICAgICAgaGlnaE1hc2sgfCAweDgwIHwgKGNvZGVwb2ludCAmIDB4M2YpCiAgICAgICk7CiAgICB9IGVsc2UKICAgIGlmIChjb2RlcG9pbnQgPCAweDExMDAwMCkgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgKICAgICAgICBoaWdoTWFzayB8IDB4ZjAgfCAoY29kZXBvaW50ID4+IDE4KSwKICAgICAgICBoaWdoTWFzayB8IDB4ODAgfCAoKGNvZGVwb2ludCA+PiAxMikgJiAweDNmKSwKICAgICAgICBoaWdoTWFzayB8IDB4ODAgfCAoKGNvZGVwb2ludCA+PiA2KSAmIDB4M2YpLAogICAgICAgIGhpZ2hNYXNrIHwgMHg4MCB8IChjb2RlcG9pbnQgJiAweDNmKQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB0b0hleChudW0sIGRpZ2l0cykgewogICAgdmFyIHJlc3VsdCA9IG51bS50b1N0cmluZygxNik7CiAgICB3aGlsZSAocmVzdWx0Lmxlbmd0aCA8IGRpZ2l0cykKICAgICAgcmVzdWx0ID0gJzAnICsgcmVzdWx0OwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIGNoZWNrQ2hhcnMocngpIHsKICAgIHJldHVybiBmdW5jdGlvbiAocykgewogICAgICB2YXIgbSA9IHJ4LmV4ZWMocyk7CiAgICAgIGlmICghbSkKICAgICAgICByZXR1cm4gczsKICAgICAgcmFpc2UobnVsbCwgZXJyb3JzLmludmFsaWRDb2RlVW5pdCwgdG9IZXgobVswXS5jaGFyQ29kZUF0KDApLCA0KS50b1VwcGVyQ2FzZSgpKTsKICAgIH07CiAgfQoKICB2YXIgZW5jb2RpbmdNb2RlcyA9IHsKICAgICdwc2V1ZG8tbGF0aW4xJzogewogICAgICBmaXh1cDogY2hlY2tDaGFycygvW15ceDAwLVx4ZmZdLyksCiAgICAgIGVuY29kZUJ5dGU6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSk7CiAgICAgIH0sCiAgICAgIGVuY29kZVVURjg6IGZ1bmN0aW9uIChjb2RlcG9pbnQpIHsKICAgICAgICByZXR1cm4gZW5jb2RlVVRGOChjb2RlcG9pbnQpOwogICAgICB9LAogICAgfSwKICAgICd4LXVzZXItZGVmaW5lZCc6IHsKICAgICAgZml4dXA6IGNoZWNrQ2hhcnMoL1teXHgwMC1ceDdmXHVmNzgwLVx1ZjdmZl0vKSwKICAgICAgZW5jb2RlQnl0ZTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKQogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIGlmICh2YWx1ZSA+PSAweDgwKQogICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgfCAweGY3MDApOwogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlKTsKICAgICAgfSwKICAgICAgZW5jb2RlVVRGODogZnVuY3Rpb24gKGNvZGVwb2ludCkgewogICAgICAgIHJldHVybiBlbmNvZGVVVEY4KGNvZGVwb2ludCwgMHhmNzAwKTsKICAgICAgfQogICAgfSwKICAgICdub25lJzogewogICAgICBkaXNjYXJkU3RyaW5nczogdHJ1ZSwKICAgICAgZml4dXA6IGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0sCiAgICAgIGVuY29kZUJ5dGU6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfSwKICAgICAgZW5jb2RlVVRGODogZnVuY3Rpb24gKGNvZGVwb2ludCkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgfQogIH07CgogIHZhciBFT0YgPSAxLAogICAgU3RyaW5nTGl0ZXJhbCA9IDIsCiAgICBLZXl3b3JkID0gNCwKICAgIElkZW50aWZpZXIgPSA4LAogICAgTnVtZXJpY0xpdGVyYWwgPSAxNiwKICAgIFB1bmN0dWF0b3IgPSAzMiwKICAgIEJvb2xlYW5MaXRlcmFsID0gNjQsCiAgICBOaWxMaXRlcmFsID0gMTI4LAogICAgVmFyYXJnTGl0ZXJhbCA9IDI1NjsKCiAgZXhwb3J0cy50b2tlblR5cGVzID0gewogICAgRU9GOiBFT0YsCiAgICBTdHJpbmdMaXRlcmFsOiBTdHJpbmdMaXRlcmFsLAogICAgS2V5d29yZDogS2V5d29yZCwKICAgIElkZW50aWZpZXI6IElkZW50aWZpZXIsCiAgICBOdW1lcmljTGl0ZXJhbDogTnVtZXJpY0xpdGVyYWwsCiAgICBQdW5jdHVhdG9yOiBQdW5jdHVhdG9yLAogICAgQm9vbGVhbkxpdGVyYWw6IEJvb2xlYW5MaXRlcmFsLAogICAgTmlsTGl0ZXJhbDogTmlsTGl0ZXJhbCwKICAgIFZhcmFyZ0xpdGVyYWw6IFZhcmFyZ0xpdGVyYWwKICB9OwoKICB2YXIgZXJyb3JzID0gZXhwb3J0cy5lcnJvcnMgPSB7CiAgICB1bmV4cGVjdGVkOiAndW5leHBlY3RlZCAlMSBcJyUyXCcgbmVhciBcJyUzXCcnLAogICAgdW5leHBlY3RlZEVPRjogJ3VuZXhwZWN0ZWQgc3ltYm9sIG5lYXIgXCc8ZW9mPlwnJywKICAgIGV4cGVjdGVkOiAnXCclMVwnIGV4cGVjdGVkIG5lYXIgXCclMlwnJywKICAgIGV4cGVjdGVkVG9rZW46ICclMSBleHBlY3RlZCBuZWFyIFwnJTJcJycsCiAgICB1bmZpbmlzaGVkU3RyaW5nOiAndW5maW5pc2hlZCBzdHJpbmcgbmVhciBcJyUxXCcnLAogICAgbWFsZm9ybWVkTnVtYmVyOiAnbWFsZm9ybWVkIG51bWJlciBuZWFyIFwnJTFcJycsCiAgICBkZWNpbWFsRXNjYXBlVG9vTGFyZ2U6ICdkZWNpbWFsIGVzY2FwZSB0b28gbGFyZ2UgbmVhciBcJyUxXCcnLAogICAgaW52YWxpZEVzY2FwZTogJ2ludmFsaWQgZXNjYXBlIHNlcXVlbmNlIG5lYXIgXCclMVwnJywKICAgIGhleGFkZWNpbWFsRGlnaXRFeHBlY3RlZDogJ2hleGFkZWNpbWFsIGRpZ2l0IGV4cGVjdGVkIG5lYXIgXCclMVwnJywKICAgIGJyYWNlRXhwZWN0ZWQ6ICdtaXNzaW5nIFwnJTFcJyBuZWFyIFwnJTJcJycsCiAgICB0b29MYXJnZUNvZGVwb2ludDogJ1VURi04IHZhbHVlIHRvbyBsYXJnZSBuZWFyIFwnJTFcJycsCiAgICB1bmZpbmlzaGVkTG9uZ1N0cmluZzogJ3VuZmluaXNoZWQgbG9uZyBzdHJpbmcgKHN0YXJ0aW5nIGF0IGxpbmUgJTEpIG5lYXIgXCclMlwnJywKICAgIHVuZmluaXNoZWRMb25nQ29tbWVudDogJ3VuZmluaXNoZWQgbG9uZyBjb21tZW50IChzdGFydGluZyBhdCBsaW5lICUxKSBuZWFyIFwnJTJcJycsCiAgICBhbWJpZ3VvdXNTeW50YXg6ICdhbWJpZ3VvdXMgc3ludGF4IChmdW5jdGlvbiBjYWxsIHggbmV3IHN0YXRlbWVudCkgbmVhciBcJyUxXCcnLAogICAgbm9Mb29wVG9CcmVhazogJ25vIGxvb3AgdG8gYnJlYWsgbmVhciBcJyUxXCcnLAogICAgbGFiZWxBbHJlYWR5RGVmaW5lZDogJ2xhYmVsIFwnJTFcJyBhbHJlYWR5IGRlZmluZWQgb24gbGluZSAlMicsCiAgICBsYWJlbE5vdFZpc2libGU6ICdubyB2aXNpYmxlIGxhYmVsIFwnJTFcJyBmb3IgPGdvdG8+JywKICAgIGdvdG9KdW1wSW5Mb2NhbFNjb3BlOiAnPGdvdG8gJTE+IGp1bXBzIGludG8gdGhlIHNjb3BlIG9mIGxvY2FsIFwnJTJcJycsCiAgICBjYW5ub3RVc2VWYXJhcmc6ICdjYW5ub3QgdXNlIFwnLi4uXCcgb3V0c2lkZSBhIHZhcmFyZyBmdW5jdGlvbiBuZWFyIFwnJTFcJycsCiAgICBpbnZhbGlkQ29kZVVuaXQ6ICdjb2RlIHVuaXQgVSslMSBpcyBub3QgYWxsb3dlZCBpbiB0aGUgY3VycmVudCBlbmNvZGluZyBtb2RlJwogIH07CgogIHZhciBhc3QgPSBleHBvcnRzLmFzdCA9IHsKICAgIGxhYmVsU3RhdGVtZW50OiBmdW5jdGlvbiAobGFiZWwpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0xhYmVsU3RhdGVtZW50JywKICAgICAgICAgIGxhYmVsOiBsYWJlbAogICAgICAgIH07CiAgICAgIH0sCiAgICBicmVha1N0YXRlbWVudDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnQnJlYWtTdGF0ZW1lbnQnCiAgICAgICAgfTsKICAgICAgfSwKICAgIGdvdG9TdGF0ZW1lbnQ6IGZ1bmN0aW9uIChsYWJlbCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnR290b1N0YXRlbWVudCcsCiAgICAgICAgICBsYWJlbDogbGFiZWwKICAgICAgICB9OwogICAgICB9LAogICAgcmV0dXJuU3RhdGVtZW50OiBmdW5jdGlvbiAoYXJncykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnUmV0dXJuU3RhdGVtZW50JywKICAgICAgICAgICdhcmd1bWVudHMnOiBhcmdzCiAgICAgICAgfTsKICAgICAgfSwKICAgIGlmU3RhdGVtZW50OiBmdW5jdGlvbiAoY2xhdXNlcykgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdJZlN0YXRlbWVudCcsCiAgICAgICAgY2xhdXNlczogY2xhdXNlcwogICAgICB9OwogICAgfSwKICAgIGlmQ2xhdXNlOiBmdW5jdGlvbiAoY29uZGl0aW9uLCBib2R5KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0lmQ2xhdXNlJywKICAgICAgICBjb25kaXRpb246IGNvbmRpdGlvbiwKICAgICAgICBib2R5OiBib2R5CiAgICAgIH07CiAgICB9LAogICAgZWxzZWlmQ2xhdXNlOiBmdW5jdGlvbiAoY29uZGl0aW9uLCBib2R5KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0Vsc2VpZkNsYXVzZScsCiAgICAgICAgY29uZGl0aW9uOiBjb25kaXRpb24sCiAgICAgICAgYm9keTogYm9keQogICAgICB9OwogICAgfSwKICAgIGVsc2VDbGF1c2U6IGZ1bmN0aW9uIChib2R5KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdFbHNlQ2xhdXNlJywKICAgICAgICAgIGJvZHk6IGJvZHkKICAgICAgICB9OwogICAgICB9LAogICAgd2hpbGVTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChjb25kaXRpb24sIGJvZHkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ1doaWxlU3RhdGVtZW50JywKICAgICAgICAgIGNvbmRpdGlvbjogY29uZGl0aW9uLAogICAgICAgICAgYm9keTogYm9keQogICAgICAgIH07CiAgICAgIH0sCiAgICBkb1N0YXRlbWVudDogZnVuY3Rpb24gKGJvZHkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0RvU3RhdGVtZW50JywKICAgICAgICAgIGJvZHk6IGJvZHkKICAgICAgICB9OwogICAgICB9LAogICAgcmVwZWF0U3RhdGVtZW50OiBmdW5jdGlvbiAoY29uZGl0aW9uLCBib2R5KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdSZXBlYXRTdGF0ZW1lbnQnLAogICAgICAgICAgY29uZGl0aW9uOiBjb25kaXRpb24sCiAgICAgICAgICBib2R5OiBib2R5CiAgICAgICAgfTsKICAgICAgfSwKICAgIGxvY2FsU3RhdGVtZW50OiBmdW5jdGlvbiAodmFyaWFibGVzLCBpbml0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdMb2NhbFN0YXRlbWVudCcsCiAgICAgICAgICB2YXJpYWJsZXM6IHZhcmlhYmxlcywKICAgICAgICAgIGluaXQ6IGluaXQKICAgICAgICB9OwogICAgICB9LAogICAgYXNzaWdubWVudFN0YXRlbWVudDogZnVuY3Rpb24gKHZhcmlhYmxlcywgaW5pdCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFN0YXRlbWVudCcsCiAgICAgICAgICB2YXJpYWJsZXM6IHZhcmlhYmxlcywKICAgICAgICAgIGluaXQ6IGluaXQKICAgICAgICB9OwogICAgICB9LAogICAgY2FsbFN0YXRlbWVudDogZnVuY3Rpb24gKGV4cHJlc3Npb24pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0NhbGxTdGF0ZW1lbnQnLAogICAgICAgICAgZXhwcmVzc2lvbjogZXhwcmVzc2lvbgogICAgICAgIH07CiAgICAgIH0sCiAgICBmdW5jdGlvblN0YXRlbWVudDogZnVuY3Rpb24gKGlkZW50aWZpZXIsIHBhcmFtZXRlcnMsIGlzTG9jYWwsIGJvZHkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0Z1bmN0aW9uRGVjbGFyYXRpb24nLAogICAgICAgICAgaWRlbnRpZmllcjogaWRlbnRpZmllciwKICAgICAgICAgIGlzTG9jYWw6IGlzTG9jYWwsCiAgICAgICAgICBwYXJhbWV0ZXJzOiBwYXJhbWV0ZXJzLAogICAgICAgICAgYm9keTogYm9keQogICAgICAgIH07CiAgICAgIH0sCiAgICBmb3JOdW1lcmljU3RhdGVtZW50OiBmdW5jdGlvbiAodmFyaWFibGUsIHN0YXJ0LCBlbmQsIHN0ZXAsIGJvZHkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0Zvck51bWVyaWNTdGF0ZW1lbnQnLAogICAgICAgICAgdmFyaWFibGU6IHZhcmlhYmxlLAogICAgICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICAgICAgZW5kOiBlbmQsCiAgICAgICAgICBzdGVwOiBzdGVwLAogICAgICAgICAgYm9keTogYm9keQogICAgICAgIH07CiAgICAgIH0sCiAgICBmb3JHZW5lcmljU3RhdGVtZW50OiBmdW5jdGlvbiAodmFyaWFibGVzLCBpdGVyYXRvcnMsIGJvZHkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ0ZvckdlbmVyaWNTdGF0ZW1lbnQnLAogICAgICAgICAgdmFyaWFibGVzOiB2YXJpYWJsZXMsCiAgICAgICAgICBpdGVyYXRvcnM6IGl0ZXJhdG9ycywKICAgICAgICAgIGJvZHk6IGJvZHkKICAgICAgICB9OwogICAgICB9LAogICAgY2h1bms6IGZ1bmN0aW9uIChib2R5KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdDaHVuaycsCiAgICAgICAgICBib2R5OiBib2R5CiAgICAgICAgfTsKICAgICAgfSwKICAgIGlkZW50aWZpZXI6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJywKICAgICAgICAgIG5hbWU6IG5hbWUKICAgICAgICB9OwogICAgICB9LAogICAgbGl0ZXJhbDogZnVuY3Rpb24gKHR5cGUsIHZhbHVlLCByYXcpIHsKICAgICAgICB0eXBlID0gKHR5cGUgPT09IFN0cmluZ0xpdGVyYWwpID8gJ1N0cmluZ0xpdGVyYWwnIDoKICAgICAgICAgICh0eXBlID09PSBOdW1lcmljTGl0ZXJhbCkgPyAnTnVtZXJpY0xpdGVyYWwnIDoKICAgICAgICAgICh0eXBlID09PSBCb29sZWFuTGl0ZXJhbCkgPyAnQm9vbGVhbkxpdGVyYWwnIDoKICAgICAgICAgICh0eXBlID09PSBOaWxMaXRlcmFsKSA/ICdOaWxMaXRlcmFsJyA6CiAgICAgICAgICAnVmFyYXJnTGl0ZXJhbCc7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgcmF3OiByYXcKICAgICAgICB9OwogICAgICB9LAogICAgdGFibGVLZXk6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1RhYmxlS2V5JywKICAgICAgICBrZXk6IGtleSwKICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgfTsKICAgIH0sCiAgICB0YWJsZUtleVN0cmluZzogZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnVGFibGVLZXlTdHJpbmcnLAogICAgICAgIGtleToga2V5LAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9OwogICAgfSwKICAgIHRhYmxlVmFsdWU6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnVGFibGVWYWx1ZScsCiAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICB9OwogICAgICB9LAogICAgdGFibGVDb25zdHJ1Y3RvckV4cHJlc3Npb246IGZ1bmN0aW9uIChmaWVsZHMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnVGFibGVDb25zdHJ1Y3RvckV4cHJlc3Npb24nLAogICAgICAgIGZpZWxkczogZmllbGRzCiAgICAgIH07CiAgICB9LAogICAgYmluYXJ5RXhwcmVzc2lvbjogZnVuY3Rpb24gKG9wZXJhdG9yLCBsZWZ0LCByaWdodCkgewogICAgICB2YXIgdHlwZSA9ICgnYW5kJyA9PT0gb3BlcmF0b3IgfHwgJ29yJyA9PT0gb3BlcmF0b3IpID8KICAgICAgICAnTG9naWNhbEV4cHJlc3Npb24nIDoKICAgICAgICAnQmluYXJ5RXhwcmVzc2lvbic7CgogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yLAogICAgICAgIGxlZnQ6IGxlZnQsCiAgICAgICAgcmlnaHQ6IHJpZ2h0CiAgICAgIH07CiAgICB9LAogICAgdW5hcnlFeHByZXNzaW9uOiBmdW5jdGlvbiAob3BlcmF0b3IsIGFyZ3VtZW50KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1VuYXJ5RXhwcmVzc2lvbicsCiAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yLAogICAgICAgIGFyZ3VtZW50OiBhcmd1bWVudAogICAgICB9OwogICAgfSwKICAgIG1lbWJlckV4cHJlc3Npb246IGZ1bmN0aW9uIChiYXNlLCBpbmRleGVyLCBpZGVudGlmaWVyKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywKICAgICAgICAgIGluZGV4ZXI6IGluZGV4ZXIsCiAgICAgICAgICBpZGVudGlmaWVyOiBpZGVudGlmaWVyLAogICAgICAgICAgYmFzZTogYmFzZQogICAgICAgIH07CiAgICAgIH0sCiAgICBpbmRleEV4cHJlc3Npb246IGZ1bmN0aW9uIChiYXNlLCBpbmRleCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAnSW5kZXhFeHByZXNzaW9uJywKICAgICAgICAgIGJhc2U6IGJhc2UsCiAgICAgICAgICBpbmRleDogaW5kZXgKICAgICAgICB9OwogICAgICB9LAogICAgY2FsbEV4cHJlc3Npb246IGZ1bmN0aW9uIChiYXNlLCBhcmdzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsCiAgICAgICAgICBiYXNlOiBiYXNlLAogICAgICAgICAgJ2FyZ3VtZW50cyc6IGFyZ3MKICAgICAgICB9OwogICAgICB9LAogICAgdGFibGVDYWxsRXhwcmVzc2lvbjogZnVuY3Rpb24gKGJhc2UsIGFyZ3MpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ1RhYmxlQ2FsbEV4cHJlc3Npb24nLAogICAgICAgICAgYmFzZTogYmFzZSwKICAgICAgICAgICdhcmd1bWVudHMnOiBhcmdzCiAgICAgICAgfTsKICAgICAgfSwKICAgIHN0cmluZ0NhbGxFeHByZXNzaW9uOiBmdW5jdGlvbiAoYmFzZSwgYXJndW1lbnQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogJ1N0cmluZ0NhbGxFeHByZXNzaW9uJywKICAgICAgICAgIGJhc2U6IGJhc2UsCiAgICAgICAgICBhcmd1bWVudDogYXJndW1lbnQKICAgICAgICB9OwogICAgICB9LAogICAgY29tbWVudDogZnVuY3Rpb24gKHZhbHVlLCByYXcpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnQ29tbWVudCcsCiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIHJhdzogcmF3CiAgICAgIH07CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gZmluaXNoTm9kZShub2RlKSB7CiAgICBpZiAodHJhY2tMb2NhdGlvbnMpIHsKICAgICAgdmFyIGxvY2F0aW9uID0gbG9jYXRpb25zLnBvcCgpOwogICAgICBsb2NhdGlvbi5jb21wbGV0ZSgpOwogICAgICBsb2NhdGlvbi5ibGVzcyhub2RlKTsKICAgIH0KICAgIGlmIChvcHRpb25zLm9uQ3JlYXRlTm9kZSkgb3B0aW9ucy5vbkNyZWF0ZU5vZGUobm9kZSk7CiAgICByZXR1cm4gbm9kZTsKICB9CgogIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCiAgdmFyIGluZGV4T2YgPSBmdW5jdGlvbiAoYXJyYXksIGVsZW1lbnQpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBpZiAoYXJyYXlbaV0gPT09IGVsZW1lbnQpIHJldHVybiBpOwogICAgfQogICAgcmV0dXJuIC0xOwogIH07CiAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mKQogICAgaW5kZXhPZiA9IGZ1bmN0aW9uIChhcnJheSwgZWxlbWVudCkgewogICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZihlbGVtZW50KTsKICAgIH07CgogIGZ1bmN0aW9uIGluZGV4T2ZPYmplY3QoYXJyYXksIHByb3BlcnR5LCBlbGVtZW50KSB7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgaWYgKGFycmF5W2ldW3Byb3BlcnR5XSA9PT0gZWxlbWVudCkgcmV0dXJuIGk7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQoKICBmdW5jdGlvbiBzcHJpbnRmKGZvcm1hdCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICBmb3JtYXQgPSBmb3JtYXQucmVwbGFjZSgvJShcZCkvZywgZnVuY3Rpb24gKG1hdGNoLCBpbmRleCkgewogICAgICByZXR1cm4gJycgKyBhcmdzW2luZGV4IC0gMV0gfHwgJyc7CiAgICB9KTsKICAgIHJldHVybiBmb3JtYXQ7CiAgfQoKICB2YXIgYXNzaWduID0gZnVuY3Rpb24gKGRlc3QpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLAogICAgICBzcmMsIHByb3A7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgc3JjID0gYXJnc1tpXTsKICAgICAgZm9yIChwcm9wIGluIHNyYykKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNyYywgcHJvcCkpIHsKICAgICAgICAgIGRlc3RbcHJvcF0gPSBzcmNbcHJvcF07CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBkZXN0OwogIH07CiAgaWYgKE9iamVjdC5hc3NpZ24pCiAgICBhc3NpZ24gPSBPYmplY3QuYXNzaWduOwoKICBmdW5jdGlvbiBmaXh1cEVycm9yKGUpIHsKICAgIGlmICghT2JqZWN0LmNyZWF0ZSkKICAgICAgcmV0dXJuIGU7CiAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShlLCB7CiAgICAgICdsaW5lJzogewogICAgICAgICd3cml0YWJsZSc6IHRydWUsCiAgICAgICAgdmFsdWU6IGUubGluZQogICAgICB9LAogICAgICAnaW5kZXgnOiB7CiAgICAgICAgJ3dyaXRhYmxlJzogdHJ1ZSwKICAgICAgICB2YWx1ZTogZS5pbmRleAogICAgICB9LAogICAgICAnY29sdW1uJzogewogICAgICAgICd3cml0YWJsZSc6IHRydWUsCiAgICAgICAgdmFsdWU6IGUuY29sdW1uCiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcmFpc2UodG9rZW4pIHsKICAgIHZhciBtZXNzYWdlID0gc3ByaW50Zi5hcHBseShudWxsLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpLAogICAgICBlcnJvciwgY29sOwoKICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0eXBlb2YgdG9rZW4ubGluZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgY29sID0gaW5kZXggLSBsaW5lU3RhcnQgKyAxOwogICAgICBlcnJvciA9IGZpeHVwRXJyb3IobmV3IFN5bnRheEVycm9yKHNwcmludGYoJ1slMTolMl0gJTMnLCBsaW5lLCBjb2wsIG1lc3NhZ2UpKSk7CiAgICAgIGVycm9yLmluZGV4ID0gaW5kZXg7CiAgICAgIGVycm9yLmxpbmUgPSBsaW5lOwogICAgICBlcnJvci5jb2x1bW4gPSBjb2w7CiAgICB9IGVsc2UgewogICAgICBjb2wgPSB0b2tlbi5yYW5nZVswXSAtIHRva2VuLmxpbmVTdGFydDsKICAgICAgZXJyb3IgPSBmaXh1cEVycm9yKG5ldyBTeW50YXhFcnJvcihzcHJpbnRmKCdbJTE6JTJdICUzJywgdG9rZW4ubGluZSwgY29sLCBtZXNzYWdlKSkpOwogICAgICBlcnJvci5saW5lID0gdG9rZW4ubGluZTsKICAgICAgZXJyb3IuaW5kZXggPSB0b2tlbi5yYW5nZVswXTsKICAgICAgZXJyb3IuY29sdW1uID0gY29sOwogICAgfQogICAgdGhyb3cgZXJyb3I7CiAgfQoKICBmdW5jdGlvbiB0b2tlblZhbHVlKHRva2VuKSB7CiAgICB2YXIgcmF3ID0gaW5wdXQuc2xpY2UodG9rZW4ucmFuZ2VbMF0sIHRva2VuLnJhbmdlWzFdKTsKICAgIGlmIChyYXcpCiAgICAgIHJldHVybiByYXc7CiAgICByZXR1cm4gdG9rZW4udmFsdWU7CiAgfQoKICBmdW5jdGlvbiByYWlzZVVuZXhwZWN0ZWRUb2tlbih0eXBlLCB0b2tlbikgewogICAgcmFpc2UodG9rZW4sIGVycm9ycy5leHBlY3RlZFRva2VuLCB0eXBlLCB0b2tlblZhbHVlKHRva2VuKSk7CiAgfQoKICBmdW5jdGlvbiB1bmV4cGVjdGVkKGZvdW5kKSB7CiAgICB2YXIgbmVhciA9IHRva2VuVmFsdWUobG9va2FoZWFkKTsKICAgIGlmICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGZvdW5kLnR5cGUpIHsKICAgICAgdmFyIHR5cGU7CiAgICAgIHN3aXRjaCAoZm91bmQudHlwZSkgewogICAgICAgIGNhc2UgU3RyaW5nTGl0ZXJhbDoKICAgICAgICAgIHR5cGUgPSAnc3RyaW5nJzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgS2V5d29yZDoKICAgICAgICAgIHR5cGUgPSAna2V5d29yZCc7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIElkZW50aWZpZXI6CiAgICAgICAgICB0eXBlID0gJ2lkZW50aWZpZXInOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBOdW1lcmljTGl0ZXJhbDoKICAgICAgICAgIHR5cGUgPSAnbnVtYmVyJzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgUHVuY3R1YXRvcjoKICAgICAgICAgIHR5cGUgPSAnc3ltYm9sJzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQm9vbGVhbkxpdGVyYWw6CiAgICAgICAgICB0eXBlID0gJ2Jvb2xlYW4nOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBOaWxMaXRlcmFsOgogICAgICAgICAgcmV0dXJuIHJhaXNlKGZvdW5kLCBlcnJvcnMudW5leHBlY3RlZCwgJ3N5bWJvbCcsICduaWwnLCBuZWFyKTsKICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgIHJldHVybiByYWlzZShmb3VuZCwgZXJyb3JzLnVuZXhwZWN0ZWRFT0YpOwogICAgICB9CiAgICAgIHJldHVybiByYWlzZShmb3VuZCwgZXJyb3JzLnVuZXhwZWN0ZWQsIHR5cGUsIHRva2VuVmFsdWUoZm91bmQpLCBuZWFyKTsKICAgIH0KICAgIHJldHVybiByYWlzZShmb3VuZCwgZXJyb3JzLnVuZXhwZWN0ZWQsICdzeW1ib2wnLCBmb3VuZCwgbmVhcik7CiAgfQoKICB2YXIgaW5kZXgsIHRva2VuLCBwcmV2aW91c1Rva2VuLCBsb29rYWhlYWQsIGNvbW1lbnRzLCB0b2tlblN0YXJ0LCBsaW5lLCBsaW5lU3RhcnQ7CgogIGV4cG9ydHMubGV4ID0gbGV4OwoKICBmdW5jdGlvbiBsZXgoKSB7CiAgICBza2lwV2hpdGVTcGFjZSgpOwogICAgd2hpbGUgKDQ1ID09PSBpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSAmJgogICAgICA0NSA9PT0gaW5wdXQuY2hhckNvZGVBdChpbmRleCArIDEpKSB7CiAgICAgIHNjYW5Db21tZW50KCk7CiAgICAgIHNraXBXaGl0ZVNwYWNlKCk7CiAgICB9CiAgICBpZiAoaW5kZXggPj0gbGVuZ3RoKSByZXR1cm4gewogICAgICB0eXBlOiBFT0YsCiAgICAgIHZhbHVlOiAnPGVvZj4nLAogICAgICBsaW5lOiBsaW5lLAogICAgICBsaW5lU3RhcnQ6IGxpbmVTdGFydCwKICAgICAgcmFuZ2U6IFtpbmRleCwgaW5kZXhdCiAgICB9OwoKICAgIHZhciBjaGFyQ29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpLAogICAgICBuZXh0ID0gaW5wdXQuY2hhckNvZGVBdChpbmRleCArIDEpOwogICAgdG9rZW5TdGFydCA9IGluZGV4OwogICAgaWYgKGlzSWRlbnRpZmllclN0YXJ0KGNoYXJDb2RlKSkgcmV0dXJuIHNjYW5JZGVudGlmaWVyT3JLZXl3b3JkKCk7CgogICAgc3dpdGNoIChjaGFyQ29kZSkgewogICAgICBjYXNlIDM5OgogICAgICBjYXNlIDM0OgogICAgICAgIHJldHVybiBzY2FuU3RyaW5nTGl0ZXJhbCgpOwogICAgICBjYXNlIDQ4OgogICAgICBjYXNlIDQ5OgogICAgICBjYXNlIDUwOgogICAgICBjYXNlIDUxOgogICAgICBjYXNlIDUyOgogICAgICBjYXNlIDUzOgogICAgICBjYXNlIDU0OgogICAgICBjYXNlIDU1OgogICAgICBjYXNlIDU2OgogICAgICBjYXNlIDU3OgogICAgICAgIHJldHVybiBzY2FuTnVtZXJpY0xpdGVyYWwoKTsKCiAgICAgIGNhc2UgNDY6CiAgICAgICAgaWYgKGlzRGVjRGlnaXQobmV4dCkpIHJldHVybiBzY2FuTnVtZXJpY0xpdGVyYWwoKTsKICAgICAgICBpZiAoNDYgPT09IG5leHQpIHsKICAgICAgICAgIGlmICg0NiA9PT0gaW5wdXQuY2hhckNvZGVBdChpbmRleCArIDIpKSByZXR1cm4gc2NhblZhcmFyZ0xpdGVyYWwoKTsKICAgICAgICAgIHJldHVybiBzY2FuUHVuY3R1YXRvcignLi4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCcuJyk7CgogICAgICBjYXNlIDYxOgogICAgICAgIGlmICg2MSA9PT0gbmV4dCkgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCc9PScpOwogICAgICAgIHJldHVybiBzY2FuUHVuY3R1YXRvcignPScpOwoKICAgICAgY2FzZSA2MjoKICAgICAgICBpZiAoZmVhdHVyZXMuYml0d2lzZU9wZXJhdG9ycykKICAgICAgICAgIGlmICg2MiA9PT0gbmV4dCkgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCc+PicpOwogICAgICAgIGlmICg2MSA9PT0gbmV4dCkgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCc+PScpOwogICAgICAgIHJldHVybiBzY2FuUHVuY3R1YXRvcignPicpOwoKICAgICAgY2FzZSA2MDoKICAgICAgICBpZiAoZmVhdHVyZXMuYml0d2lzZU9wZXJhdG9ycykKICAgICAgICAgIGlmICg2MCA9PT0gbmV4dCkgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCc8PCcpOwogICAgICAgIGlmICg2MSA9PT0gbmV4dCkgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCc8PScpOwogICAgICAgIHJldHVybiBzY2FuUHVuY3R1YXRvcignPCcpOwoKICAgICAgY2FzZSAxMjY6CiAgICAgICAgaWYgKDYxID09PSBuZXh0KSByZXR1cm4gc2NhblB1bmN0dWF0b3IoJ349Jyk7CiAgICAgICAgaWYgKCFmZWF0dXJlcy5iaXR3aXNlT3BlcmF0b3JzKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCd+Jyk7CgogICAgICBjYXNlIDU4OgogICAgICAgIGlmIChmZWF0dXJlcy5sYWJlbHMpCiAgICAgICAgICBpZiAoNTggPT09IG5leHQpIHJldHVybiBzY2FuUHVuY3R1YXRvcignOjonKTsKICAgICAgICByZXR1cm4gc2NhblB1bmN0dWF0b3IoJzonKTsKCiAgICAgIGNhc2UgOTE6CiAgICAgICAgaWYgKDkxID09PSBuZXh0IHx8IDYxID09PSBuZXh0KSByZXR1cm4gc2NhbkxvbmdTdHJpbmdMaXRlcmFsKCk7CiAgICAgICAgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKCdbJyk7CgogICAgICBjYXNlIDQ3OgogICAgICAgIGlmIChmZWF0dXJlcy5pbnRlZ2VyRGl2aXNpb24pCiAgICAgICAgICBpZiAoNDcgPT09IG5leHQpIHJldHVybiBzY2FuUHVuY3R1YXRvcignLy8nKTsKICAgICAgICByZXR1cm4gc2NhblB1bmN0dWF0b3IoJy8nKTsKCiAgICAgIGNhc2UgMzg6CiAgICAgIGNhc2UgMTI0OgogICAgICAgIGlmICghZmVhdHVyZXMuYml0d2lzZU9wZXJhdG9ycykKICAgICAgICAgIGJyZWFrOwogICAgICBjYXNlIDQyOgogICAgICBjYXNlIDk0OgogICAgICBjYXNlIDM3OgogICAgICBjYXNlIDQ0OgogICAgICBjYXNlIDEyMzoKICAgICAgY2FzZSAxMjU6CiAgICAgIGNhc2UgOTM6CiAgICAgIGNhc2UgNDA6CiAgICAgIGNhc2UgNDE6CiAgICAgIGNhc2UgNTk6CiAgICAgIGNhc2UgMzU6CiAgICAgIGNhc2UgNDU6CiAgICAgIGNhc2UgNDM6CiAgICAgICAgcmV0dXJuIHNjYW5QdW5jdHVhdG9yKGlucHV0LmNoYXJBdChpbmRleCkpOwogICAgfQoKICAgIHJldHVybiB1bmV4cGVjdGVkKGlucHV0LmNoYXJBdChpbmRleCkpOwogIH0KCiAgZnVuY3Rpb24gY29uc3VtZUVPTCgpIHsKICAgIHZhciBjaGFyQ29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpLAogICAgICBwZWVrQ2hhckNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGluZGV4ICsgMSk7CgogICAgaWYgKGlzTGluZVRlcm1pbmF0b3IoY2hhckNvZGUpKSB7CiAgICAgIGlmICgxMCA9PT0gY2hhckNvZGUgJiYgMTMgPT09IHBlZWtDaGFyQ29kZSkgKytpbmRleDsKICAgICAgaWYgKDEzID09PSBjaGFyQ29kZSAmJiAxMCA9PT0gcGVla0NoYXJDb2RlKSArK2luZGV4OwogICAgICArK2xpbmU7CiAgICAgIGxpbmVTdGFydCA9ICsraW5kZXg7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHNraXBXaGl0ZVNwYWNlKCkgewogICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBjaGFyQ29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpOwogICAgICBpZiAoaXNXaGl0ZVNwYWNlKGNoYXJDb2RlKSkgewogICAgICAgICsraW5kZXg7CiAgICAgIH0gZWxzZSBpZiAoIWNvbnN1bWVFT0woKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzY2FuSWRlbnRpZmllck9yS2V5d29yZCgpIHsKICAgIHZhciB2YWx1ZSwgdHlwZTsKICAgIHdoaWxlIChpc0lkZW50aWZpZXJQYXJ0KGlucHV0LmNoYXJDb2RlQXQoKytpbmRleCkpKTsKICAgIHZhbHVlID0gZW5jb2RpbmdNb2RlLmZpeHVwKGlucHV0LnNsaWNlKHRva2VuU3RhcnQsIGluZGV4KSk7CiAgICBpZiAoaXNLZXl3b3JkKHZhbHVlKSkgewogICAgICB0eXBlID0gS2V5d29yZDsKICAgIH0gZWxzZSBpZiAoJ3RydWUnID09PSB2YWx1ZSB8fCAnZmFsc2UnID09PSB2YWx1ZSkgewogICAgICB0eXBlID0gQm9vbGVhbkxpdGVyYWw7CiAgICAgIHZhbHVlID0gKCd0cnVlJyA9PT0gdmFsdWUpOwogICAgfSBlbHNlIGlmICgnbmlsJyA9PT0gdmFsdWUpIHsKICAgICAgdHlwZSA9IE5pbExpdGVyYWw7CiAgICAgIHZhbHVlID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHR5cGUgPSBJZGVudGlmaWVyOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgbGluZTogbGluZSwKICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIHJhbmdlOiBbdG9rZW5TdGFydCwgaW5kZXhdCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gc2NhblB1bmN0dWF0b3IodmFsdWUpIHsKICAgIGluZGV4ICs9IHZhbHVlLmxlbmd0aDsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFB1bmN0dWF0b3IsCiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgbGluZTogbGluZSwKICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIHJhbmdlOiBbdG9rZW5TdGFydCwgaW5kZXhdCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gc2NhblZhcmFyZ0xpdGVyYWwoKSB7CiAgICBpbmRleCArPSAzOwogICAgcmV0dXJuIHsKICAgICAgdHlwZTogVmFyYXJnTGl0ZXJhbCwKICAgICAgdmFsdWU6ICcuLi4nLAogICAgICBsaW5lOiBsaW5lLAogICAgICBsaW5lU3RhcnQ6IGxpbmVTdGFydCwKICAgICAgcmFuZ2U6IFt0b2tlblN0YXJ0LCBpbmRleF0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBzY2FuU3RyaW5nTGl0ZXJhbCgpIHsKICAgIHZhciBkZWxpbWl0ZXIgPSBpbnB1dC5jaGFyQ29kZUF0KGluZGV4KyspLAogICAgICBiZWdpbkxpbmUgPSBsaW5lLAogICAgICBiZWdpbkxpbmVTdGFydCA9IGxpbmVTdGFydCwKICAgICAgc3RyaW5nU3RhcnQgPSBpbmRleCwKICAgICAgc3RyaW5nID0gZW5jb2RpbmdNb2RlLmRpc2NhcmRTdHJpbmdzID8gbnVsbCA6ICcnLAogICAgICBjaGFyQ29kZTsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGNoYXJDb2RlID0gaW5wdXQuY2hhckNvZGVBdChpbmRleCsrKTsKICAgICAgaWYgKGRlbGltaXRlciA9PT0gY2hhckNvZGUpIGJyZWFrOwogICAgICBpZiAoaW5kZXggPiBsZW5ndGggfHwgaXNMaW5lVGVybWluYXRvcihjaGFyQ29kZSkpIHsKICAgICAgICBzdHJpbmcgKz0gaW5wdXQuc2xpY2Uoc3RyaW5nU3RhcnQsIGluZGV4IC0gMSk7CiAgICAgICAgcmFpc2UobnVsbCwgZXJyb3JzLnVuZmluaXNoZWRTdHJpbmcsIGlucHV0LnNsaWNlKHRva2VuU3RhcnQsIGluZGV4IC0gMSkpOwogICAgICB9CiAgICAgIGlmICg5MiA9PT0gY2hhckNvZGUpIHsKICAgICAgICBpZiAoIWVuY29kaW5nTW9kZS5kaXNjYXJkU3RyaW5ncykgewogICAgICAgICAgdmFyIGJlZm9yZUVzY2FwZSA9IGlucHV0LnNsaWNlKHN0cmluZ1N0YXJ0LCBpbmRleCAtIDEpOwogICAgICAgICAgc3RyaW5nICs9IGVuY29kaW5nTW9kZS5maXh1cChiZWZvcmVFc2NhcGUpOwogICAgICAgIH0KICAgICAgICB2YXIgZXNjYXBlVmFsdWUgPSByZWFkRXNjYXBlU2VxdWVuY2UoKTsKICAgICAgICBpZiAoIWVuY29kaW5nTW9kZS5kaXNjYXJkU3RyaW5ncykKICAgICAgICAgIHN0cmluZyArPSBlc2NhcGVWYWx1ZTsKICAgICAgICBzdHJpbmdTdGFydCA9IGluZGV4OwogICAgICB9CiAgICB9CiAgICBpZiAoIWVuY29kaW5nTW9kZS5kaXNjYXJkU3RyaW5ncykgewogICAgICBzdHJpbmcgKz0gZW5jb2RpbmdNb2RlLmVuY29kZUJ5dGUobnVsbCk7CiAgICAgIHN0cmluZyArPSBlbmNvZGluZ01vZGUuZml4dXAoaW5wdXQuc2xpY2Uoc3RyaW5nU3RhcnQsIGluZGV4IC0gMSkpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFN0cmluZ0xpdGVyYWwsCiAgICAgIHZhbHVlOiBzdHJpbmcsCiAgICAgIGxpbmU6IGJlZ2luTGluZSwKICAgICAgbGluZVN0YXJ0OiBiZWdpbkxpbmVTdGFydCwKICAgICAgbGFzdExpbmU6IGxpbmUsCiAgICAgIGxhc3RMaW5lU3RhcnQ6IGxpbmVTdGFydCwKICAgICAgcmFuZ2U6IFt0b2tlblN0YXJ0LCBpbmRleF0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBzY2FuTG9uZ1N0cmluZ0xpdGVyYWwoKSB7CiAgICB2YXIgYmVnaW5MaW5lID0gbGluZSwKICAgICAgYmVnaW5MaW5lU3RhcnQgPSBsaW5lU3RhcnQsCiAgICAgIHN0cmluZyA9IHJlYWRMb25nU3RyaW5nKGZhbHNlKTsKICAgIGlmIChmYWxzZSA9PT0gc3RyaW5nKSByYWlzZSh0b2tlbiwgZXJyb3JzLmV4cGVjdGVkLCAnWycsIHRva2VuVmFsdWUodG9rZW4pKTsKCiAgICByZXR1cm4gewogICAgICB0eXBlOiBTdHJpbmdMaXRlcmFsLAogICAgICB2YWx1ZTogZW5jb2RpbmdNb2RlLmRpc2NhcmRTdHJpbmdzID8gbnVsbCA6IGVuY29kaW5nTW9kZS5maXh1cChzdHJpbmcpLAogICAgICBsaW5lOiBiZWdpbkxpbmUsCiAgICAgIGxpbmVTdGFydDogYmVnaW5MaW5lU3RhcnQsCiAgICAgIGxhc3RMaW5lOiBsaW5lLAogICAgICBsYXN0TGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIHJhbmdlOiBbdG9rZW5TdGFydCwgaW5kZXhdCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gc2Nhbk51bWVyaWNMaXRlcmFsKCkgewogICAgdmFyIGNoYXJhY3RlciA9IGlucHV0LmNoYXJBdChpbmRleCksCiAgICAgIG5leHQgPSBpbnB1dC5jaGFyQXQoaW5kZXggKyAxKTsKCiAgICB2YXIgdmFsdWUgPSAoJzAnID09PSBjaGFyYWN0ZXIgJiYgJ3hYJy5pbmRleE9mKG5leHQgfHwgbnVsbCkgPj0gMCkgPwogICAgICByZWFkSGV4TGl0ZXJhbCgpIDogcmVhZERlY0xpdGVyYWwoKTsKCiAgICByZXR1cm4gewogICAgICB0eXBlOiBOdW1lcmljTGl0ZXJhbCwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBsaW5lOiBsaW5lLAogICAgICBsaW5lU3RhcnQ6IGxpbmVTdGFydCwKICAgICAgcmFuZ2U6IFt0b2tlblN0YXJ0LCBpbmRleF0KICAgIH07CiAgfQoKICBmdW5jdGlvbiByZWFkSGV4TGl0ZXJhbCgpIHsKICAgIHZhciBmcmFjdGlvbiA9IDAsCiAgICAgIGJpbmFyeUV4cG9uZW50ID0gMSwKICAgICAgYmluYXJ5U2lnbiA9IDEsCiAgICAgIGRpZ2l0LCBmcmFjdGlvblN0YXJ0LCBleHBvbmVudFN0YXJ0LCBkaWdpdFN0YXJ0OwoKICAgIGRpZ2l0U3RhcnQgPSBpbmRleCArPSAyOwogICAgaWYgKCFpc0hleERpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpKSkKICAgICAgcmFpc2UobnVsbCwgZXJyb3JzLm1hbGZvcm1lZE51bWJlciwgaW5wdXQuc2xpY2UodG9rZW5TdGFydCwgaW5kZXgpKTsKCiAgICB3aGlsZSAoaXNIZXhEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpICsraW5kZXg7CiAgICBkaWdpdCA9IHBhcnNlSW50KGlucHV0LnNsaWNlKGRpZ2l0U3RhcnQsIGluZGV4KSwgMTYpOwogICAgaWYgKCcuJyA9PT0gaW5wdXQuY2hhckF0KGluZGV4KSkgewogICAgICBmcmFjdGlvblN0YXJ0ID0gKytpbmRleDsKCiAgICAgIHdoaWxlIChpc0hleERpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpKSkgKytpbmRleDsKICAgICAgZnJhY3Rpb24gPSBpbnB1dC5zbGljZShmcmFjdGlvblN0YXJ0LCBpbmRleCk7CiAgICAgIGZyYWN0aW9uID0gKGZyYWN0aW9uU3RhcnQgPT09IGluZGV4KSA/IDAgOgogICAgICAgIHBhcnNlSW50KGZyYWN0aW9uLCAxNikgLyBNYXRoLnBvdygxNiwgaW5kZXggLSBmcmFjdGlvblN0YXJ0KTsKICAgIH0KICAgIGlmICgncFAnLmluZGV4T2YoaW5wdXQuY2hhckF0KGluZGV4KSB8fCBudWxsKSA+PSAwKSB7CiAgICAgICsraW5kZXg7CiAgICAgIGlmICgnKy0nLmluZGV4T2YoaW5wdXQuY2hhckF0KGluZGV4KSB8fCBudWxsKSA+PSAwKQogICAgICAgIGJpbmFyeVNpZ24gPSAoJysnID09PSBpbnB1dC5jaGFyQXQoaW5kZXgrKykpID8gMSA6IC0xOwoKICAgICAgZXhwb25lbnRTdGFydCA9IGluZGV4OwogICAgICBpZiAoIWlzRGVjRGlnaXQoaW5wdXQuY2hhckNvZGVBdChpbmRleCkpKQogICAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5tYWxmb3JtZWROdW1iZXIsIGlucHV0LnNsaWNlKHRva2VuU3RhcnQsIGluZGV4KSk7CgogICAgICB3aGlsZSAoaXNEZWNEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpICsraW5kZXg7CiAgICAgIGJpbmFyeUV4cG9uZW50ID0gaW5wdXQuc2xpY2UoZXhwb25lbnRTdGFydCwgaW5kZXgpOwogICAgICBiaW5hcnlFeHBvbmVudCA9IE1hdGgucG93KDIsIGJpbmFyeUV4cG9uZW50ICogYmluYXJ5U2lnbik7CiAgICB9CgogICAgcmV0dXJuIChkaWdpdCArIGZyYWN0aW9uKSAqIGJpbmFyeUV4cG9uZW50OwogIH0KCiAgZnVuY3Rpb24gcmVhZERlY0xpdGVyYWwoKSB7CiAgICB3aGlsZSAoaXNEZWNEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpICsraW5kZXg7CiAgICBpZiAoJy4nID09PSBpbnB1dC5jaGFyQXQoaW5kZXgpKSB7CiAgICAgICsraW5kZXg7CiAgICAgIHdoaWxlIChpc0RlY0RpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpKSkgKytpbmRleDsKICAgIH0KICAgIGlmICgnZUUnLmluZGV4T2YoaW5wdXQuY2hhckF0KGluZGV4KSB8fCBudWxsKSA+PSAwKSB7CiAgICAgICsraW5kZXg7CiAgICAgIGlmICgnKy0nLmluZGV4T2YoaW5wdXQuY2hhckF0KGluZGV4KSB8fCBudWxsKSA+PSAwKSArK2luZGV4OwogICAgICBpZiAoIWlzRGVjRGlnaXQoaW5wdXQuY2hhckNvZGVBdChpbmRleCkpKQogICAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5tYWxmb3JtZWROdW1iZXIsIGlucHV0LnNsaWNlKHRva2VuU3RhcnQsIGluZGV4KSk7CgogICAgICB3aGlsZSAoaXNEZWNEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpICsraW5kZXg7CiAgICB9CgogICAgcmV0dXJuIHBhcnNlRmxvYXQoaW5wdXQuc2xpY2UodG9rZW5TdGFydCwgaW5kZXgpKTsKICB9CgogIGZ1bmN0aW9uIHJlYWRVbmljb2RlRXNjYXBlU2VxdWVuY2UoKSB7CiAgICB2YXIgc2VxdWVuY2VTdGFydCA9IGluZGV4Kys7CgogICAgaWYgKGlucHV0LmNoYXJBdChpbmRleCsrKSAhPT0gJ3snKQogICAgICByYWlzZShudWxsLCBlcnJvcnMuYnJhY2VFeHBlY3RlZCwgJ3snLCAnXFwnICsgaW5wdXQuc2xpY2Uoc2VxdWVuY2VTdGFydCwgaW5kZXgpKTsKICAgIGlmICghaXNIZXhEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpCiAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5oZXhhZGVjaW1hbERpZ2l0RXhwZWN0ZWQsICdcXCcgKyBpbnB1dC5zbGljZShzZXF1ZW5jZVN0YXJ0LCBpbmRleCkpOwoKICAgIHdoaWxlIChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSA9PT0gMHgzMCkgKytpbmRleDsKICAgIHZhciBlc2NTdGFydCA9IGluZGV4OwoKICAgIHdoaWxlIChpc0hleERpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpKSkgewogICAgICArK2luZGV4OwogICAgICBpZiAoaW5kZXggLSBlc2NTdGFydCA+IDYpCiAgICAgICAgcmFpc2UobnVsbCwgZXJyb3JzLnRvb0xhcmdlQ29kZXBvaW50LCAnXFwnICsgaW5wdXQuc2xpY2Uoc2VxdWVuY2VTdGFydCwgaW5kZXgpKTsKICAgIH0KCiAgICB2YXIgYiA9IGlucHV0LmNoYXJBdChpbmRleCsrKTsKICAgIGlmIChiICE9PSAnfScpIHsKICAgICAgaWYgKChiID09PSAnIicpIHx8IChiID09PSAiJyIpKQogICAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5icmFjZUV4cGVjdGVkLCAnfScsICdcXCcgKyBpbnB1dC5zbGljZShzZXF1ZW5jZVN0YXJ0LCBpbmRleC0tKSk7CiAgICAgIGVsc2UKICAgICAgICByYWlzZShudWxsLCBlcnJvcnMuaGV4YWRlY2ltYWxEaWdpdEV4cGVjdGVkLCAnXFwnICsgaW5wdXQuc2xpY2Uoc2VxdWVuY2VTdGFydCwgaW5kZXgpKTsKICAgIH0KCiAgICB2YXIgY29kZXBvaW50ID0gcGFyc2VJbnQoaW5wdXQuc2xpY2UoZXNjU3RhcnQsIGluZGV4IC0gMSkgfHwgJzAnLCAxNik7CiAgICB2YXIgZnJhZyA9ICdcXCcgKyBpbnB1dC5zbGljZShzZXF1ZW5jZVN0YXJ0LCBpbmRleCk7CgogICAgaWYgKGNvZGVwb2ludCA+IDB4MTBmZmZmKSB7CiAgICAgIHJhaXNlKG51bGwsIGVycm9ycy50b29MYXJnZUNvZGVwb2ludCwgZnJhZyk7CiAgICB9CgogICAgcmV0dXJuIGVuY29kaW5nTW9kZS5lbmNvZGVVVEY4KGNvZGVwb2ludCwgZnJhZyk7CiAgfQoKICBmdW5jdGlvbiByZWFkRXNjYXBlU2VxdWVuY2UoKSB7CiAgICB2YXIgc2VxdWVuY2VTdGFydCA9IGluZGV4OwogICAgc3dpdGNoIChpbnB1dC5jaGFyQXQoaW5kZXgpKSB7CiAgICAgIGNhc2UgJ2EnOgogICAgICAgICsraW5kZXg7CiAgICAgICAgcmV0dXJuICdceDA3JzsKICAgICAgY2FzZSAnbic6CiAgICAgICAgKytpbmRleDsKICAgICAgICByZXR1cm4gJ1xuJzsKICAgICAgY2FzZSAncic6CiAgICAgICAgKytpbmRleDsKICAgICAgICByZXR1cm4gJ1xyJzsKICAgICAgY2FzZSAndCc6CiAgICAgICAgKytpbmRleDsKICAgICAgICByZXR1cm4gJ1x0JzsKICAgICAgY2FzZSAndic6CiAgICAgICAgKytpbmRleDsKICAgICAgICByZXR1cm4gJ1x4MGInOwogICAgICBjYXNlICdiJzoKICAgICAgICArK2luZGV4OwogICAgICAgIHJldHVybiAnXGInOwogICAgICBjYXNlICdmJzoKICAgICAgICArK2luZGV4OwogICAgICAgIHJldHVybiAnXGYnOwogICAgICBjYXNlICdccic6CiAgICAgIGNhc2UgJ1xuJzoKICAgICAgICBjb25zdW1lRU9MKCk7CiAgICAgICAgcmV0dXJuICdcbic7CgogICAgICBjYXNlICcwJzoKICAgICAgY2FzZSAnMSc6CiAgICAgIGNhc2UgJzInOgogICAgICBjYXNlICczJzoKICAgICAgY2FzZSAnNCc6CiAgICAgIGNhc2UgJzUnOgogICAgICBjYXNlICc2JzoKICAgICAgY2FzZSAnNyc6CiAgICAgIGNhc2UgJzgnOgogICAgICBjYXNlICc5JzoKICAgICAgICB3aGlsZSAoaXNEZWNEaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkgJiYgaW5kZXggLSBzZXF1ZW5jZVN0YXJ0IDwgMykgKytpbmRleDsKCiAgICAgICAgdmFyIGZyYWcgPSBpbnB1dC5zbGljZShzZXF1ZW5jZVN0YXJ0LCBpbmRleCk7CiAgICAgICAgdmFyIGRkZCA9IHBhcnNlSW50KGZyYWcsIDEwKTsKICAgICAgICBpZiAoZGRkID4gMjU1KSB7CiAgICAgICAgICByYWlzZShudWxsLCBlcnJvcnMuZGVjaW1hbEVzY2FwZVRvb0xhcmdlLCAnXFwnICsgZGRkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVuY29kaW5nTW9kZS5lbmNvZGVCeXRlKGRkZCwgJ1xcJyArIGZyYWcpOwoKICAgICAgY2FzZSAneic6CiAgICAgICAgaWYgKGZlYXR1cmVzLnNraXBXaGl0ZXNwYWNlRXNjYXBlKSB7CiAgICAgICAgICArK2luZGV4OwogICAgICAgICAgc2tpcFdoaXRlU3BhY2UoKTsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd4JzoKICAgICAgICBpZiAoZmVhdHVyZXMuaGV4RXNjYXBlcykgewogICAgICAgICAgaWYgKGlzSGV4RGlnaXQoaW5wdXQuY2hhckNvZGVBdChpbmRleCArIDEpKSAmJgogICAgICAgICAgICBpc0hleERpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXggKyAyKSkpIHsKICAgICAgICAgICAgaW5kZXggKz0gMzsKICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nTW9kZS5lbmNvZGVCeXRlKHBhcnNlSW50KGlucHV0LnNsaWNlKHNlcXVlbmNlU3RhcnQgKyAxLCBpbmRleCksIDE2KSwgJ1xcJyArIGlucHV0LnNsaWNlKHNlcXVlbmNlU3RhcnQsIGluZGV4KSk7CiAgICAgICAgICB9CiAgICAgICAgICByYWlzZShudWxsLCBlcnJvcnMuaGV4YWRlY2ltYWxEaWdpdEV4cGVjdGVkLCAnXFwnICsgaW5wdXQuc2xpY2Uoc2VxdWVuY2VTdGFydCwgaW5kZXggKyAyKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndSc6CiAgICAgICAgaWYgKGZlYXR1cmVzLnVuaWNvZGVFc2NhcGVzKQogICAgICAgICAgcmV0dXJuIHJlYWRVbmljb2RlRXNjYXBlU2VxdWVuY2UoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ1xcJzoKICAgICAgY2FzZSAnIic6CiAgICAgIGNhc2UgIiciOgogICAgICAgIHJldHVybiBpbnB1dC5jaGFyQXQoaW5kZXgrKyk7CiAgICB9CgogICAgaWYgKGZlYXR1cmVzLnN0cmljdEVzY2FwZXMpCiAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5pbnZhbGlkRXNjYXBlLCAnXFwnICsgaW5wdXQuc2xpY2Uoc2VxdWVuY2VTdGFydCwgaW5kZXggKyAxKSk7CiAgICByZXR1cm4gaW5wdXQuY2hhckF0KGluZGV4KyspOwogIH0KCiAgZnVuY3Rpb24gc2NhbkNvbW1lbnQoKSB7CiAgICB0b2tlblN0YXJ0ID0gaW5kZXg7CiAgICBpbmRleCArPSAyOwoKICAgIHZhciBjaGFyYWN0ZXIgPSBpbnB1dC5jaGFyQXQoaW5kZXgpLAogICAgICBjb250ZW50ID0gJycsCiAgICAgIGlzTG9uZyA9IGZhbHNlLAogICAgICBjb21tZW50U3RhcnQgPSBpbmRleCwKICAgICAgbGluZVN0YXJ0Q29tbWVudCA9IGxpbmVTdGFydCwKICAgICAgbGluZUNvbW1lbnQgPSBsaW5lOwoKICAgIGlmICgnWycgPT09IGNoYXJhY3RlcikgewogICAgICBjb250ZW50ID0gcmVhZExvbmdTdHJpbmcodHJ1ZSk7CiAgICAgIGlmIChmYWxzZSA9PT0gY29udGVudCkgY29udGVudCA9IGNoYXJhY3RlcjsKICAgICAgZWxzZSBpc0xvbmcgPSB0cnVlOwogICAgfQogICAgaWYgKCFpc0xvbmcpIHsKICAgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgaWYgKGlzTGluZVRlcm1pbmF0b3IoaW5wdXQuY2hhckNvZGVBdChpbmRleCkpKSBicmVhazsKICAgICAgICArK2luZGV4OwogICAgICB9CiAgICAgIGlmIChvcHRpb25zLmNvbW1lbnRzKSBjb250ZW50ID0gaW5wdXQuc2xpY2UoY29tbWVudFN0YXJ0LCBpbmRleCk7CiAgICB9CgogICAgaWYgKG9wdGlvbnMuY29tbWVudHMpIHsKICAgICAgdmFyIG5vZGUgPSBhc3QuY29tbWVudChjb250ZW50LCBpbnB1dC5zbGljZSh0b2tlblN0YXJ0LCBpbmRleCkpOwogICAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHsKICAgICAgICBub2RlLmxvYyA9IHsKICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgIGxpbmU6IGxpbmVDb21tZW50LAogICAgICAgICAgICBjb2x1bW46IHRva2VuU3RhcnQgLSBsaW5lU3RhcnRDb21tZW50CiAgICAgICAgICB9LAogICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgIGxpbmU6IGxpbmUsCiAgICAgICAgICAgIGNvbHVtbjogaW5kZXggLSBsaW5lU3RhcnQKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICAgIGlmIChvcHRpb25zLnJhbmdlcykgewogICAgICAgIG5vZGUucmFuZ2UgPSBbdG9rZW5TdGFydCwgaW5kZXhdOwogICAgICB9CiAgICAgIGlmIChvcHRpb25zLm9uQ3JlYXRlTm9kZSkgb3B0aW9ucy5vbkNyZWF0ZU5vZGUobm9kZSk7CiAgICAgIGNvbW1lbnRzLnB1c2gobm9kZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZWFkTG9uZ1N0cmluZyhpc0NvbW1lbnQpIHsKICAgIHZhciBsZXZlbCA9IDAsCiAgICAgIGNvbnRlbnQgPSAnJywKICAgICAgdGVybWluYXRvciA9IGZhbHNlLAogICAgICBjaGFyYWN0ZXIsIHN0cmluZ1N0YXJ0LCBmaXJzdExpbmUgPSBsaW5lOwoKICAgICsraW5kZXg7CiAgICB3aGlsZSAoJz0nID09PSBpbnB1dC5jaGFyQXQoaW5kZXggKyBsZXZlbCkpICsrbGV2ZWw7CiAgICBpZiAoJ1snICE9PSBpbnB1dC5jaGFyQXQoaW5kZXggKyBsZXZlbCkpIHJldHVybiBmYWxzZTsKCiAgICBpbmRleCArPSBsZXZlbCArIDE7CiAgICBpZiAoaXNMaW5lVGVybWluYXRvcihpbnB1dC5jaGFyQ29kZUF0KGluZGV4KSkpIGNvbnN1bWVFT0woKTsKCiAgICBzdHJpbmdTdGFydCA9IGluZGV4OwogICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHdoaWxlIChpc0xpbmVUZXJtaW5hdG9yKGlucHV0LmNoYXJDb2RlQXQoaW5kZXgpKSkgY29uc3VtZUVPTCgpOwoKICAgICAgY2hhcmFjdGVyID0gaW5wdXQuY2hhckF0KGluZGV4KyspOwogICAgICBpZiAoJ10nID09PSBjaGFyYWN0ZXIpIHsKICAgICAgICB0ZXJtaW5hdG9yID0gdHJ1ZTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxldmVsOyArK2kpIHsKICAgICAgICAgIGlmICgnPScgIT09IGlucHV0LmNoYXJBdChpbmRleCArIGkpKSB0ZXJtaW5hdG9yID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgnXScgIT09IGlucHV0LmNoYXJBdChpbmRleCArIGxldmVsKSkgdGVybWluYXRvciA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmICh0ZXJtaW5hdG9yKSB7CiAgICAgICAgY29udGVudCArPSBpbnB1dC5zbGljZShzdHJpbmdTdGFydCwgaW5kZXggLSAxKTsKICAgICAgICBpbmRleCArPSBsZXZlbCArIDE7CiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICAgIH0KICAgIH0KCiAgICByYWlzZShudWxsLCBpc0NvbW1lbnQgPwogICAgICBlcnJvcnMudW5maW5pc2hlZExvbmdDb21tZW50IDoKICAgICAgZXJyb3JzLnVuZmluaXNoZWRMb25nU3RyaW5nLAogICAgICBmaXJzdExpbmUsICc8ZW9mPicpOwogIH0KCiAgZnVuY3Rpb24gbmV4dCgpIHsKICAgIHByZXZpb3VzVG9rZW4gPSB0b2tlbjsKICAgIHRva2VuID0gbG9va2FoZWFkOwogICAgbG9va2FoZWFkID0gbGV4KCk7CiAgfQoKICBmdW5jdGlvbiBjb25zdW1lKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IHRva2VuLnZhbHVlKSB7CiAgICAgIG5leHQoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBleHBlY3QodmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PT0gdG9rZW4udmFsdWUpIG5leHQoKTsKICAgIGVsc2UgcmFpc2UodG9rZW4sIGVycm9ycy5leHBlY3RlZCwgdmFsdWUsIHRva2VuVmFsdWUodG9rZW4pKTsKICB9CgogIGZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjaGFyQ29kZSkgewogICAgcmV0dXJuIDkgPT09IGNoYXJDb2RlIHx8IDMyID09PSBjaGFyQ29kZSB8fCAweEIgPT09IGNoYXJDb2RlIHx8IDB4QyA9PT0gY2hhckNvZGU7CiAgfQoKICBmdW5jdGlvbiBpc0xpbmVUZXJtaW5hdG9yKGNoYXJDb2RlKSB7CiAgICByZXR1cm4gMTAgPT09IGNoYXJDb2RlIHx8IDEzID09PSBjaGFyQ29kZTsKICB9CgogIGZ1bmN0aW9uIGlzRGVjRGlnaXQoY2hhckNvZGUpIHsKICAgIHJldHVybiBjaGFyQ29kZSA+PSA0OCAmJiBjaGFyQ29kZSA8PSA1NzsKICB9CgogIGZ1bmN0aW9uIGlzSGV4RGlnaXQoY2hhckNvZGUpIHsKICAgIHJldHVybiAoY2hhckNvZGUgPj0gNDggJiYgY2hhckNvZGUgPD0gNTcpIHx8IChjaGFyQ29kZSA+PSA5NyAmJiBjaGFyQ29kZSA8PSAxMDIpIHx8IChjaGFyQ29kZSA+PSA2NSAmJiBjaGFyQ29kZSA8PSA3MCk7CiAgfQoKICBmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydChjaGFyQ29kZSkgewogICAgaWYgKChjaGFyQ29kZSA+PSA2NSAmJiBjaGFyQ29kZSA8PSA5MCkgfHwgKGNoYXJDb2RlID49IDk3ICYmIGNoYXJDb2RlIDw9IDEyMikgfHwgOTUgPT09IGNoYXJDb2RlKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGlmIChmZWF0dXJlcy5leHRlbmRlZElkZW50aWZpZXJzICYmIGNoYXJDb2RlID49IDEyOCkKICAgICAgcmV0dXJuIHRydWU7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBpc0lkZW50aWZpZXJQYXJ0KGNoYXJDb2RlKSB7CiAgICBpZiAoKGNoYXJDb2RlID49IDY1ICYmIGNoYXJDb2RlIDw9IDkwKSB8fCAoY2hhckNvZGUgPj0gOTcgJiYgY2hhckNvZGUgPD0gMTIyKSB8fCA5NSA9PT0gY2hhckNvZGUgfHwgKGNoYXJDb2RlID49IDQ4ICYmIGNoYXJDb2RlIDw9IDU3KSkKICAgICAgcmV0dXJuIHRydWU7CiAgICBpZiAoZmVhdHVyZXMuZXh0ZW5kZWRJZGVudGlmaWVycyAmJiBjaGFyQ29kZSA+PSAxMjgpCiAgICAgIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gaXNLZXl3b3JkKGlkKSB7CiAgICBzd2l0Y2ggKGlkLmxlbmd0aCkgewogICAgICBjYXNlIDI6CiAgICAgICAgcmV0dXJuICdkbycgPT09IGlkIHx8ICdpZicgPT09IGlkIHx8ICdpbicgPT09IGlkIHx8ICdvcicgPT09IGlkOwogICAgICBjYXNlIDM6CiAgICAgICAgcmV0dXJuICdhbmQnID09PSBpZCB8fCAnZW5kJyA9PT0gaWQgfHwgJ2ZvcicgPT09IGlkIHx8ICdub3QnID09PSBpZDsKICAgICAgY2FzZSA0OgogICAgICAgIGlmICgnZWxzZScgPT09IGlkIHx8ICd0aGVuJyA9PT0gaWQpCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZmVhdHVyZXMubGFiZWxzICYmICFmZWF0dXJlcy5jb250ZXh0dWFsR290bykKICAgICAgICAgIHJldHVybiAoJ2dvdG8nID09PSBpZCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBjYXNlIDU6CiAgICAgICAgcmV0dXJuICdicmVhaycgPT09IGlkIHx8ICdsb2NhbCcgPT09IGlkIHx8ICd1bnRpbCcgPT09IGlkIHx8ICd3aGlsZScgPT09IGlkOwogICAgICBjYXNlIDY6CiAgICAgICAgcmV0dXJuICdlbHNlaWYnID09PSBpZCB8fCAncmVwZWF0JyA9PT0gaWQgfHwgJ3JldHVybicgPT09IGlkOwogICAgICBjYXNlIDg6CiAgICAgICAgcmV0dXJuICdmdW5jdGlvbicgPT09IGlkOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gaXNVbmFyeSh0b2tlbikgewogICAgaWYgKFB1bmN0dWF0b3IgPT09IHRva2VuLnR5cGUpIHJldHVybiAnIy1+Jy5pbmRleE9mKHRva2VuLnZhbHVlKSA+PSAwOwogICAgaWYgKEtleXdvcmQgPT09IHRva2VuLnR5cGUpIHJldHVybiAnbm90JyA9PT0gdG9rZW4udmFsdWU7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBpc0Jsb2NrRm9sbG93KHRva2VuKSB7CiAgICBpZiAoRU9GID09PSB0b2tlbi50eXBlKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChLZXl3b3JkICE9PSB0b2tlbi50eXBlKSByZXR1cm4gZmFsc2U7CiAgICBzd2l0Y2ggKHRva2VuLnZhbHVlKSB7CiAgICAgIGNhc2UgJ2Vsc2UnOgogICAgICBjYXNlICdlbHNlaWYnOgogICAgICBjYXNlICdlbmQnOgogICAgICBjYXNlICd1bnRpbCc6CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICB2YXIgc2NvcGVzLCBzY29wZURlcHRoLCBnbG9iYWxzOwoKICBmdW5jdGlvbiBjcmVhdGVTY29wZSgpIHsKICAgIHZhciBzY29wZSA9IEFycmF5LmFwcGx5KG51bGwsIHNjb3Blc1tzY29wZURlcHRoKytdKTsKICAgIHNjb3Blcy5wdXNoKHNjb3BlKTsKICAgIGlmIChvcHRpb25zLm9uQ3JlYXRlU2NvcGUpIG9wdGlvbnMub25DcmVhdGVTY29wZSgpOwogIH0KCiAgZnVuY3Rpb24gZGVzdHJveVNjb3BlKCkgewogICAgdmFyIHNjb3BlID0gc2NvcGVzLnBvcCgpOwogICAgLS1zY29wZURlcHRoOwogICAgaWYgKG9wdGlvbnMub25EZXN0cm95U2NvcGUpIG9wdGlvbnMub25EZXN0cm95U2NvcGUoKTsKICB9CgogIGZ1bmN0aW9uIHNjb3BlSWRlbnRpZmllck5hbWUobmFtZSkgewogICAgaWYgKG9wdGlvbnMub25Mb2NhbERlY2xhcmF0aW9uKSBvcHRpb25zLm9uTG9jYWxEZWNsYXJhdGlvbihuYW1lKTsKICAgIGlmICgtMSAhPT0gaW5kZXhPZihzY29wZXNbc2NvcGVEZXB0aF0sIG5hbWUpKSByZXR1cm47CiAgICBzY29wZXNbc2NvcGVEZXB0aF0ucHVzaChuYW1lKTsKICB9CgogIGZ1bmN0aW9uIHNjb3BlSWRlbnRpZmllcihub2RlKSB7CiAgICBzY29wZUlkZW50aWZpZXJOYW1lKG5vZGUubmFtZSk7CiAgICBhdHRhY2hTY29wZShub2RlLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGF0dGFjaFNjb3BlKG5vZGUsIGlzTG9jYWwpIHsKICAgIGlmICghaXNMb2NhbCAmJiAtMSA9PT0gaW5kZXhPZk9iamVjdChnbG9iYWxzLCAnbmFtZScsIG5vZGUubmFtZSkpCiAgICAgIGdsb2JhbHMucHVzaChub2RlKTsKCiAgICBub2RlLmlzTG9jYWwgPSBpc0xvY2FsOwogIH0KCiAgZnVuY3Rpb24gc2NvcGVIYXNOYW1lKG5hbWUpIHsKICAgIHJldHVybiAoLTEgIT09IGluZGV4T2Yoc2NvcGVzW3Njb3BlRGVwdGhdLCBuYW1lKSk7CiAgfQoKICB2YXIgbG9jYXRpb25zID0gW10sCiAgICB0cmFja0xvY2F0aW9uczsKCiAgZnVuY3Rpb24gY3JlYXRlTG9jYXRpb25NYXJrZXIoKSB7CiAgICByZXR1cm4gbmV3IE1hcmtlcih0b2tlbik7CiAgfQoKICBmdW5jdGlvbiBNYXJrZXIodG9rZW4pIHsKICAgIGlmIChvcHRpb25zLmxvY2F0aW9ucykgewogICAgICB0aGlzLmxvYyA9IHsKICAgICAgICBzdGFydDogewogICAgICAgICAgbGluZTogdG9rZW4ubGluZSwKICAgICAgICAgIGNvbHVtbjogdG9rZW4ucmFuZ2VbMF0gLSB0b2tlbi5saW5lU3RhcnQKICAgICAgICB9LAogICAgICAgIGVuZDogewogICAgICAgICAgbGluZTogMCwKICAgICAgICAgIGNvbHVtbjogMAogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIGlmIChvcHRpb25zLnJhbmdlcykgdGhpcy5yYW5nZSA9IFt0b2tlbi5yYW5nZVswXSwgMF07CiAgfQogIE1hcmtlci5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAob3B0aW9ucy5sb2NhdGlvbnMpIHsKICAgICAgdGhpcy5sb2MuZW5kLmxpbmUgPSBwcmV2aW91c1Rva2VuLmxhc3RMaW5lIHx8IHByZXZpb3VzVG9rZW4ubGluZTsKICAgICAgdGhpcy5sb2MuZW5kLmNvbHVtbiA9IHByZXZpb3VzVG9rZW4ucmFuZ2VbMV0gLSAocHJldmlvdXNUb2tlbi5sYXN0TGluZVN0YXJ0IHx8IHByZXZpb3VzVG9rZW4ubGluZVN0YXJ0KTsKICAgIH0KICAgIGlmIChvcHRpb25zLnJhbmdlcykgewogICAgICB0aGlzLnJhbmdlWzFdID0gcHJldmlvdXNUb2tlbi5yYW5nZVsxXTsKICAgIH0KICB9OwoKICBNYXJrZXIucHJvdG90eXBlLmJsZXNzID0gZnVuY3Rpb24gKG5vZGUpIHsKICAgIGlmICh0aGlzLmxvYykgewogICAgICB2YXIgbG9jID0gdGhpcy5sb2M7CiAgICAgIG5vZGUubG9jID0gewogICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICBsaW5lOiBsb2Muc3RhcnQubGluZSwKICAgICAgICAgIGNvbHVtbjogbG9jLnN0YXJ0LmNvbHVtbgogICAgICAgIH0sCiAgICAgICAgZW5kOiB7CiAgICAgICAgICBsaW5lOiBsb2MuZW5kLmxpbmUsCiAgICAgICAgICBjb2x1bW46IGxvYy5lbmQuY29sdW1uCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgaWYgKHRoaXMucmFuZ2UpIHsKICAgICAgbm9kZS5yYW5nZSA9IFsKICAgICAgICB0aGlzLnJhbmdlWzBdLAogICAgICAgIHRoaXMucmFuZ2VbMV0KICAgICAgXTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBtYXJrTG9jYXRpb24oKSB7CiAgICBpZiAodHJhY2tMb2NhdGlvbnMpIGxvY2F0aW9ucy5wdXNoKGNyZWF0ZUxvY2F0aW9uTWFya2VyKCkpOwogIH0KCiAgZnVuY3Rpb24gcHVzaExvY2F0aW9uKG1hcmtlcikgewogICAgaWYgKHRyYWNrTG9jYXRpb25zKSBsb2NhdGlvbnMucHVzaChtYXJrZXIpOwogIH0KCiAgZnVuY3Rpb24gRnVsbEZsb3dDb250ZXh0KCkgewogICAgdGhpcy5zY29wZXMgPSBbXTsKICAgIHRoaXMucGVuZGluZ0dvdG9zID0gW107CiAgfQoKICBGdWxsRmxvd0NvbnRleHQucHJvdG90eXBlLmlzSW5Mb29wID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGkgPSB0aGlzLnNjb3Blcy5sZW5ndGg7CiAgICB3aGlsZSAoaS0tID4gMCkgewogICAgICBpZiAodGhpcy5zY29wZXNbaV0uaXNMb29wKQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIEZ1bGxGbG93Q29udGV4dC5wcm90b3R5cGUucHVzaFNjb3BlID0gZnVuY3Rpb24gKGlzTG9vcCkgewogICAgdmFyIHNjb3BlID0gewogICAgICBsYWJlbHM6IHt9LAogICAgICBsb2NhbHM6IFtdLAogICAgICBkZWZlcnJlZEdvdG9zOiBbXSwKICAgICAgaXNMb29wOiAhIWlzTG9vcAogICAgfTsKICAgIHRoaXMuc2NvcGVzLnB1c2goc2NvcGUpOwogIH07CgogIEZ1bGxGbG93Q29udGV4dC5wcm90b3R5cGUucG9wU2NvcGUgPSBmdW5jdGlvbiAoKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGVuZGluZ0dvdG9zLmxlbmd0aDsgKytpKSB7CiAgICAgIHZhciB0aGVHb3RvID0gdGhpcy5wZW5kaW5nR290b3NbaV07CiAgICAgIGlmICh0aGVHb3RvLm1heERlcHRoID49IHRoaXMuc2NvcGVzLmxlbmd0aCkKICAgICAgICBpZiAoLS10aGVHb3RvLm1heERlcHRoIDw9IDApCiAgICAgICAgICByYWlzZSh0aGVHb3RvLnRva2VuLCBlcnJvcnMubGFiZWxOb3RWaXNpYmxlLCB0aGVHb3RvLnRhcmdldCk7CiAgICB9CgogICAgdGhpcy5zY29wZXMucG9wKCk7CiAgfTsKCiAgRnVsbEZsb3dDb250ZXh0LnByb3RvdHlwZS5hZGRHb3RvID0gZnVuY3Rpb24gKHRhcmdldCwgdG9rZW4pIHsKICAgIHZhciBsb2NhbENvdW50cyA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zY29wZXMubGVuZ3RoOyArK2kpIHsKICAgICAgdmFyIHNjb3BlID0gdGhpcy5zY29wZXNbaV07CiAgICAgIGxvY2FsQ291bnRzLnB1c2goc2NvcGUubG9jYWxzLmxlbmd0aCk7CiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc2NvcGUubGFiZWxzLCB0YXJnZXQpKQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLnBlbmRpbmdHb3Rvcy5wdXNoKHsKICAgICAgbWF4RGVwdGg6IHRoaXMuc2NvcGVzLmxlbmd0aCwKICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgIHRva2VuOiB0b2tlbiwKICAgICAgbG9jYWxDb3VudHM6IGxvY2FsQ291bnRzCiAgICB9KTsKICB9OwoKICBGdWxsRmxvd0NvbnRleHQucHJvdG90eXBlLmFkZExhYmVsID0gZnVuY3Rpb24gKG5hbWUsIHRva2VuKSB7CiAgICB2YXIgc2NvcGUgPSB0aGlzLmN1cnJlbnRTY29wZSgpOwoKICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc2NvcGUubGFiZWxzLCBuYW1lKSkgewogICAgICByYWlzZSh0b2tlbiwgZXJyb3JzLmxhYmVsQWxyZWFkeURlZmluZWQsIG5hbWUsIHNjb3BlLmxhYmVsc1tuYW1lXS5saW5lKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBuZXdHb3RvcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBlbmRpbmdHb3Rvcy5sZW5ndGg7ICsraSkgewogICAgICAgIHZhciB0aGVHb3RvID0gdGhpcy5wZW5kaW5nR290b3NbaV07CgogICAgICAgIGlmICh0aGVHb3RvLm1heERlcHRoID49IHRoaXMuc2NvcGVzLmxlbmd0aCAmJiB0aGVHb3RvLnRhcmdldCA9PT0gbmFtZSkgewogICAgICAgICAgaWYgKHRoZUdvdG8ubG9jYWxDb3VudHNbdGhpcy5zY29wZXMubGVuZ3RoIC0gMV0gPCBzY29wZS5sb2NhbHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHNjb3BlLmRlZmVycmVkR290b3MucHVzaCh0aGVHb3RvKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgbmV3R290b3MucHVzaCh0aGVHb3RvKTsKICAgICAgfQoKICAgICAgdGhpcy5wZW5kaW5nR290b3MgPSBuZXdHb3RvczsKICAgIH0KCiAgICBzY29wZS5sYWJlbHNbbmFtZV0gPSB7CiAgICAgIGxvY2FsQ291bnQ6IHNjb3BlLmxvY2Fscy5sZW5ndGgsCiAgICAgIGxpbmU6IHRva2VuLmxpbmUKICAgIH07CiAgfTsKCiAgRnVsbEZsb3dDb250ZXh0LnByb3RvdHlwZS5hZGRMb2NhbCA9IGZ1bmN0aW9uIChuYW1lLCB0b2tlbikgewogICAgdGhpcy5jdXJyZW50U2NvcGUoKS5sb2NhbHMucHVzaCh7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHRva2VuOiB0b2tlbgogICAgfSk7CiAgfTsKCiAgRnVsbEZsb3dDb250ZXh0LnByb3RvdHlwZS5jdXJyZW50U2NvcGUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5zY29wZXNbdGhpcy5zY29wZXMubGVuZ3RoIC0gMV07CiAgfTsKCiAgRnVsbEZsb3dDb250ZXh0LnByb3RvdHlwZS5yYWlzZURlZmVycmVkRXJyb3JzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNjb3BlID0gdGhpcy5jdXJyZW50U2NvcGUoKTsKICAgIHZhciBiYWRzID0gc2NvcGUuZGVmZXJyZWRHb3RvczsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmFkcy5sZW5ndGg7ICsraSkgewogICAgICB2YXIgdGhlR290byA9IGJhZHNbaV07CiAgICAgIHJhaXNlKHRoZUdvdG8udG9rZW4sIGVycm9ycy5nb3RvSnVtcEluTG9jYWxTY29wZSwgdGhlR290by50YXJnZXQsIHNjb3BlLmxvY2Fsc1t0aGVHb3RvLmxvY2FsQ291bnRzW3RoaXMuc2NvcGVzLmxlbmd0aCAtIDFdXS5uYW1lKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBMb29wRmxvd0NvbnRleHQoKSB7CiAgICB0aGlzLmxldmVsID0gMDsKICAgIHRoaXMubG9vcExldmVscyA9IFtdOwogIH0KCiAgTG9vcEZsb3dDb250ZXh0LnByb3RvdHlwZS5pc0luTG9vcCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAhIXRoaXMubG9vcExldmVscy5sZW5ndGg7CiAgfTsKCiAgTG9vcEZsb3dDb250ZXh0LnByb3RvdHlwZS5wdXNoU2NvcGUgPSBmdW5jdGlvbiAoaXNMb29wKSB7CiAgICArK3RoaXMubGV2ZWw7CiAgICBpZiAoaXNMb29wKQogICAgICB0aGlzLmxvb3BMZXZlbHMucHVzaCh0aGlzLmxldmVsKTsKICB9OwoKICBMb29wRmxvd0NvbnRleHQucHJvdG90eXBlLnBvcFNjb3BlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGxldmVscyA9IHRoaXMubG9vcExldmVsczsKICAgIHZhciBsZXZsZW4gPSBsZXZlbHMubGVuZ3RoOwogICAgaWYgKGxldmxlbikgewogICAgICBpZiAobGV2ZWxzW2xldmxlbiAtIDFdID09PSB0aGlzLmxldmVsKQogICAgICAgIGxldmVscy5wb3AoKTsKICAgIH0KICAgIC0tdGhpcy5sZXZlbDsKICB9OwoKICBMb29wRmxvd0NvbnRleHQucHJvdG90eXBlLmFkZEdvdG8gPQogICAgTG9vcEZsb3dDb250ZXh0LnByb3RvdHlwZS5hZGRMYWJlbCA9CiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuJyk7CiAgICB9OwoKICBMb29wRmxvd0NvbnRleHQucHJvdG90eXBlLmFkZExvY2FsID0KICAgIExvb3BGbG93Q29udGV4dC5wcm90b3R5cGUucmFpc2VEZWZlcnJlZEVycm9ycyA9CiAgICBmdW5jdGlvbiAoKSB7fTsKCiAgZnVuY3Rpb24gbWFrZUZsb3dDb250ZXh0KCkgewogICAgcmV0dXJuIGZlYXR1cmVzLmxhYmVscyA/IG5ldyBGdWxsRmxvd0NvbnRleHQoKSA6IG5ldyBMb29wRmxvd0NvbnRleHQoKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlQ2h1bmsoKSB7CiAgICBuZXh0KCk7CiAgICBtYXJrTG9jYXRpb24oKTsKICAgIGlmIChvcHRpb25zLnNjb3BlKSBjcmVhdGVTY29wZSgpOwogICAgdmFyIGZsb3dDb250ZXh0ID0gbWFrZUZsb3dDb250ZXh0KCk7CiAgICBmbG93Q29udGV4dC5hbGxvd1ZhcmFyZyA9IHRydWU7CiAgICBmbG93Q29udGV4dC5wdXNoU2NvcGUoKTsKICAgIHZhciBib2R5ID0gcGFyc2VCbG9jayhmbG93Q29udGV4dCk7CiAgICBmbG93Q29udGV4dC5wb3BTY29wZSgpOwogICAgaWYgKG9wdGlvbnMuc2NvcGUpIGRlc3Ryb3lTY29wZSgpOwogICAgaWYgKEVPRiAhPT0gdG9rZW4udHlwZSkgdW5leHBlY3RlZCh0b2tlbik7CiAgICBpZiAodHJhY2tMb2NhdGlvbnMgJiYgIWJvZHkubGVuZ3RoKSBwcmV2aW91c1Rva2VuID0gdG9rZW47CiAgICByZXR1cm4gZmluaXNoTm9kZShhc3QuY2h1bmsoYm9keSkpOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VCbG9jayhmbG93Q29udGV4dCkgewogICAgdmFyIGJsb2NrID0gW10sCiAgICAgIHN0YXRlbWVudDsKCiAgICB3aGlsZSAoIWlzQmxvY2tGb2xsb3codG9rZW4pKSB7CiAgICAgIGlmICgncmV0dXJuJyA9PT0gdG9rZW4udmFsdWUgfHwgKCFmZWF0dXJlcy5yZWxheGVkQnJlYWsgJiYgJ2JyZWFrJyA9PT0gdG9rZW4udmFsdWUpKSB7CiAgICAgICAgYmxvY2sucHVzaChwYXJzZVN0YXRlbWVudChmbG93Q29udGV4dCkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHN0YXRlbWVudCA9IHBhcnNlU3RhdGVtZW50KGZsb3dDb250ZXh0KTsKICAgICAgY29uc3VtZSgnOycpOwogICAgICBpZiAoc3RhdGVtZW50KSBibG9jay5wdXNoKHN0YXRlbWVudCk7CiAgICB9CiAgICByZXR1cm4gYmxvY2s7CiAgfQoKICBmdW5jdGlvbiBwYXJzZVN0YXRlbWVudChmbG93Q29udGV4dCkgewogICAgbWFya0xvY2F0aW9uKCk7CgogICAgaWYgKFB1bmN0dWF0b3IgPT09IHRva2VuLnR5cGUpIHsKICAgICAgaWYgKGNvbnN1bWUoJzo6JykpIHJldHVybiBwYXJzZUxhYmVsU3RhdGVtZW50KGZsb3dDb250ZXh0KTsKICAgIH0KICAgIGlmIChmZWF0dXJlcy5lbXB0eVN0YXRlbWVudCkgewogICAgICBpZiAoY29uc3VtZSgnOycpKSB7CiAgICAgICAgaWYgKHRyYWNrTG9jYXRpb25zKSBsb2NhdGlvbnMucG9wKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgZmxvd0NvbnRleHQucmFpc2VEZWZlcnJlZEVycm9ycygpOwoKICAgIGlmIChLZXl3b3JkID09PSB0b2tlbi50eXBlKSB7CiAgICAgIHN3aXRjaCAodG9rZW4udmFsdWUpIHsKICAgICAgICBjYXNlICdsb2NhbCc6CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VMb2NhbFN0YXRlbWVudChmbG93Q29udGV4dCk7CiAgICAgICAgY2FzZSAnaWYnOgogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgcmV0dXJuIHBhcnNlSWZTdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJ3JldHVybic6CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VSZXR1cm5TdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIHZhciBuYW1lID0gcGFyc2VGdW5jdGlvbk5hbWUoKTsKICAgICAgICAgIHJldHVybiBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24obmFtZSk7CiAgICAgICAgY2FzZSAnd2hpbGUnOgogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgcmV0dXJuIHBhcnNlV2hpbGVTdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJ2Zvcic6CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VGb3JTdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJ3JlcGVhdCc6CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICByZXR1cm4gcGFyc2VSZXBlYXRTdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJ2JyZWFrJzoKICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIGlmICghZmxvd0NvbnRleHQuaXNJbkxvb3AoKSkKICAgICAgICAgICAgcmFpc2UodG9rZW4sIGVycm9ycy5ub0xvb3BUb0JyZWFrLCB0b2tlbi52YWx1ZSk7CiAgICAgICAgICByZXR1cm4gcGFyc2VCcmVha1N0YXRlbWVudCgpOwogICAgICAgIGNhc2UgJ2RvJzoKICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIHJldHVybiBwYXJzZURvU3RhdGVtZW50KGZsb3dDb250ZXh0KTsKICAgICAgICBjYXNlICdnb3RvJzoKICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIHJldHVybiBwYXJzZUdvdG9TdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgICB9CiAgICB9CgogICAgaWYgKGZlYXR1cmVzLmNvbnRleHR1YWxHb3RvICYmCiAgICAgIHRva2VuLnR5cGUgPT09IElkZW50aWZpZXIgJiYgdG9rZW4udmFsdWUgPT09ICdnb3RvJyAmJgogICAgICBsb29rYWhlYWQudHlwZSA9PT0gSWRlbnRpZmllciAmJiBsb29rYWhlYWQudmFsdWUgIT09ICdnb3RvJykgewogICAgICBuZXh0KCk7CiAgICAgIHJldHVybiBwYXJzZUdvdG9TdGF0ZW1lbnQoZmxvd0NvbnRleHQpOwogICAgfQogICAgaWYgKHRyYWNrTG9jYXRpb25zKSBsb2NhdGlvbnMucG9wKCk7CgogICAgcmV0dXJuIHBhcnNlQXNzaWdubWVudE9yQ2FsbFN0YXRlbWVudChmbG93Q29udGV4dCk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZUxhYmVsU3RhdGVtZW50KGZsb3dDb250ZXh0KSB7CiAgICB2YXIgbmFtZVRva2VuID0gdG9rZW4sCiAgICAgIGxhYmVsID0gcGFyc2VJZGVudGlmaWVyKCk7CgogICAgaWYgKG9wdGlvbnMuc2NvcGUpIHsKICAgICAgc2NvcGVJZGVudGlmaWVyTmFtZSgnOjonICsgbmFtZVRva2VuLnZhbHVlICsgJzo6Jyk7CiAgICAgIGF0dGFjaFNjb3BlKGxhYmVsLCB0cnVlKTsKICAgIH0KCiAgICBleHBlY3QoJzo6Jyk7CgogICAgZmxvd0NvbnRleHQuYWRkTGFiZWwobmFtZVRva2VuLnZhbHVlLCBuYW1lVG9rZW4pOwogICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmxhYmVsU3RhdGVtZW50KGxhYmVsKSk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZUJyZWFrU3RhdGVtZW50KCkgewogICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmJyZWFrU3RhdGVtZW50KCkpOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VHb3RvU3RhdGVtZW50KGZsb3dDb250ZXh0KSB7CiAgICB2YXIgbmFtZSA9IHRva2VuLnZhbHVlLAogICAgICBnb3RvVG9rZW4gPSBwcmV2aW91c1Rva2VuLAogICAgICBsYWJlbCA9IHBhcnNlSWRlbnRpZmllcigpOwoKICAgIGZsb3dDb250ZXh0LmFkZEdvdG8obmFtZSwgZ290b1Rva2VuKTsKICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5nb3RvU3RhdGVtZW50KGxhYmVsKSk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZURvU3RhdGVtZW50KGZsb3dDb250ZXh0KSB7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgY3JlYXRlU2NvcGUoKTsKICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSgpOwogICAgdmFyIGJvZHkgPSBwYXJzZUJsb2NrKGZsb3dDb250ZXh0KTsKICAgIGZsb3dDb250ZXh0LnBvcFNjb3BlKCk7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgZGVzdHJveVNjb3BlKCk7CiAgICBleHBlY3QoJ2VuZCcpOwogICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmRvU3RhdGVtZW50KGJvZHkpKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlV2hpbGVTdGF0ZW1lbnQoZmxvd0NvbnRleHQpIHsKICAgIHZhciBjb25kaXRpb24gPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICBleHBlY3QoJ2RvJyk7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgY3JlYXRlU2NvcGUoKTsKICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSh0cnVlKTsKICAgIHZhciBib2R5ID0gcGFyc2VCbG9jayhmbG93Q29udGV4dCk7CiAgICBmbG93Q29udGV4dC5wb3BTY29wZSgpOwogICAgaWYgKG9wdGlvbnMuc2NvcGUpIGRlc3Ryb3lTY29wZSgpOwogICAgZXhwZWN0KCdlbmQnKTsKICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC53aGlsZVN0YXRlbWVudChjb25kaXRpb24sIGJvZHkpKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlUmVwZWF0U3RhdGVtZW50KGZsb3dDb250ZXh0KSB7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgY3JlYXRlU2NvcGUoKTsKICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSh0cnVlKTsKICAgIHZhciBib2R5ID0gcGFyc2VCbG9jayhmbG93Q29udGV4dCk7CiAgICBleHBlY3QoJ3VudGlsJyk7CiAgICBmbG93Q29udGV4dC5yYWlzZURlZmVycmVkRXJyb3JzKCk7CiAgICB2YXIgY29uZGl0aW9uID0gcGFyc2VFeHBlY3RlZEV4cHJlc3Npb24oZmxvd0NvbnRleHQpOwogICAgZmxvd0NvbnRleHQucG9wU2NvcGUoKTsKICAgIGlmIChvcHRpb25zLnNjb3BlKSBkZXN0cm95U2NvcGUoKTsKICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5yZXBlYXRTdGF0ZW1lbnQoY29uZGl0aW9uLCBib2R5KSk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZVJldHVyblN0YXRlbWVudChmbG93Q29udGV4dCkgewogICAgdmFyIGV4cHJlc3Npb25zID0gW107CgogICAgaWYgKCdlbmQnICE9PSB0b2tlbi52YWx1ZSkgewogICAgICB2YXIgZXhwcmVzc2lvbiA9IHBhcnNlRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgIGlmIChudWxsICE9IGV4cHJlc3Npb24pIGV4cHJlc3Npb25zLnB1c2goZXhwcmVzc2lvbik7CiAgICAgIHdoaWxlIChjb25zdW1lKCcsJykpIHsKICAgICAgICBleHByZXNzaW9uID0gcGFyc2VFeHBlY3RlZEV4cHJlc3Npb24oZmxvd0NvbnRleHQpOwogICAgICAgIGV4cHJlc3Npb25zLnB1c2goZXhwcmVzc2lvbik7CiAgICAgIH0KICAgICAgY29uc3VtZSgnOycpOwogICAgfQogICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LnJldHVyblN0YXRlbWVudChleHByZXNzaW9ucykpOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VJZlN0YXRlbWVudChmbG93Q29udGV4dCkgewogICAgdmFyIGNsYXVzZXMgPSBbXSwKICAgICAgY29uZGl0aW9uLCBib2R5LCBtYXJrZXI7CiAgICBpZiAodHJhY2tMb2NhdGlvbnMpIHsKICAgICAgbWFya2VyID0gbG9jYXRpb25zW2xvY2F0aW9ucy5sZW5ndGggLSAxXTsKICAgICAgbG9jYXRpb25zLnB1c2gobWFya2VyKTsKICAgIH0KICAgIGNvbmRpdGlvbiA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgIGV4cGVjdCgndGhlbicpOwogICAgaWYgKG9wdGlvbnMuc2NvcGUpIGNyZWF0ZVNjb3BlKCk7CiAgICBmbG93Q29udGV4dC5wdXNoU2NvcGUoKTsKICAgIGJvZHkgPSBwYXJzZUJsb2NrKGZsb3dDb250ZXh0KTsKICAgIGZsb3dDb250ZXh0LnBvcFNjb3BlKCk7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgZGVzdHJveVNjb3BlKCk7CiAgICBjbGF1c2VzLnB1c2goZmluaXNoTm9kZShhc3QuaWZDbGF1c2UoY29uZGl0aW9uLCBib2R5KSkpOwoKICAgIGlmICh0cmFja0xvY2F0aW9ucykgbWFya2VyID0gY3JlYXRlTG9jYXRpb25NYXJrZXIoKTsKICAgIHdoaWxlIChjb25zdW1lKCdlbHNlaWYnKSkgewogICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgY29uZGl0aW9uID0gcGFyc2VFeHBlY3RlZEV4cHJlc3Npb24oZmxvd0NvbnRleHQpOwogICAgICBleHBlY3QoJ3RoZW4nKTsKICAgICAgaWYgKG9wdGlvbnMuc2NvcGUpIGNyZWF0ZVNjb3BlKCk7CiAgICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSgpOwogICAgICBib2R5ID0gcGFyc2VCbG9jayhmbG93Q29udGV4dCk7CiAgICAgIGZsb3dDb250ZXh0LnBvcFNjb3BlKCk7CiAgICAgIGlmIChvcHRpb25zLnNjb3BlKSBkZXN0cm95U2NvcGUoKTsKICAgICAgY2xhdXNlcy5wdXNoKGZpbmlzaE5vZGUoYXN0LmVsc2VpZkNsYXVzZShjb25kaXRpb24sIGJvZHkpKSk7CiAgICAgIGlmICh0cmFja0xvY2F0aW9ucykgbWFya2VyID0gY3JlYXRlTG9jYXRpb25NYXJrZXIoKTsKICAgIH0KCiAgICBpZiAoY29uc3VtZSgnZWxzZScpKSB7CiAgICAgIGlmICh0cmFja0xvY2F0aW9ucykgewogICAgICAgIG1hcmtlciA9IG5ldyBNYXJrZXIocHJldmlvdXNUb2tlbik7CiAgICAgICAgbG9jYXRpb25zLnB1c2gobWFya2VyKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy5zY29wZSkgY3JlYXRlU2NvcGUoKTsKICAgICAgZmxvd0NvbnRleHQucHVzaFNjb3BlKCk7CiAgICAgIGJvZHkgPSBwYXJzZUJsb2NrKGZsb3dDb250ZXh0KTsKICAgICAgZmxvd0NvbnRleHQucG9wU2NvcGUoKTsKICAgICAgaWYgKG9wdGlvbnMuc2NvcGUpIGRlc3Ryb3lTY29wZSgpOwogICAgICBjbGF1c2VzLnB1c2goZmluaXNoTm9kZShhc3QuZWxzZUNsYXVzZShib2R5KSkpOwogICAgfQoKICAgIGV4cGVjdCgnZW5kJyk7CiAgICByZXR1cm4gZmluaXNoTm9kZShhc3QuaWZTdGF0ZW1lbnQoY2xhdXNlcykpOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VGb3JTdGF0ZW1lbnQoZmxvd0NvbnRleHQpIHsKICAgIHZhciB2YXJpYWJsZSA9IHBhcnNlSWRlbnRpZmllcigpLAogICAgICBib2R5OwoKICAgIGlmIChvcHRpb25zLnNjb3BlKSB7CiAgICAgIGNyZWF0ZVNjb3BlKCk7CiAgICAgIHNjb3BlSWRlbnRpZmllcih2YXJpYWJsZSk7CiAgICB9CiAgICBpZiAoY29uc3VtZSgnPScpKSB7CiAgICAgIHZhciBzdGFydCA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgZXhwZWN0KCcsJyk7CiAgICAgIHZhciBlbmQgPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgIHZhciBzdGVwID0gY29uc3VtZSgnLCcpID8gcGFyc2VFeHBlY3RlZEV4cHJlc3Npb24oZmxvd0NvbnRleHQpIDogbnVsbDsKCiAgICAgIGV4cGVjdCgnZG8nKTsKICAgICAgZmxvd0NvbnRleHQucHVzaFNjb3BlKHRydWUpOwogICAgICBib2R5ID0gcGFyc2VCbG9jayhmbG93Q29udGV4dCk7CiAgICAgIGZsb3dDb250ZXh0LnBvcFNjb3BlKCk7CiAgICAgIGV4cGVjdCgnZW5kJyk7CiAgICAgIGlmIChvcHRpb25zLnNjb3BlKSBkZXN0cm95U2NvcGUoKTsKCiAgICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5mb3JOdW1lcmljU3RhdGVtZW50KHZhcmlhYmxlLCBzdGFydCwgZW5kLCBzdGVwLCBib2R5KSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgdmFyaWFibGVzID0gW3ZhcmlhYmxlXTsKICAgICAgd2hpbGUgKGNvbnN1bWUoJywnKSkgewogICAgICAgIHZhcmlhYmxlID0gcGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgaWYgKG9wdGlvbnMuc2NvcGUpIHNjb3BlSWRlbnRpZmllcih2YXJpYWJsZSk7CiAgICAgICAgdmFyaWFibGVzLnB1c2godmFyaWFibGUpOwogICAgICB9CiAgICAgIGV4cGVjdCgnaW4nKTsKICAgICAgdmFyIGl0ZXJhdG9ycyA9IFtdOwogICAgICBkbyB7CiAgICAgICAgdmFyIGV4cHJlc3Npb24gPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgICAgaXRlcmF0b3JzLnB1c2goZXhwcmVzc2lvbik7CiAgICAgIH0gd2hpbGUgKGNvbnN1bWUoJywnKSk7CgogICAgICBleHBlY3QoJ2RvJyk7CiAgICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSh0cnVlKTsKICAgICAgYm9keSA9IHBhcnNlQmxvY2soZmxvd0NvbnRleHQpOwogICAgICBmbG93Q29udGV4dC5wb3BTY29wZSgpOwogICAgICBleHBlY3QoJ2VuZCcpOwogICAgICBpZiAob3B0aW9ucy5zY29wZSkgZGVzdHJveVNjb3BlKCk7CgogICAgICByZXR1cm4gZmluaXNoTm9kZShhc3QuZm9yR2VuZXJpY1N0YXRlbWVudCh2YXJpYWJsZXMsIGl0ZXJhdG9ycywgYm9keSkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VMb2NhbFN0YXRlbWVudChmbG93Q29udGV4dCkgewogICAgdmFyIG5hbWUsIGRlY2xUb2tlbiA9IHByZXZpb3VzVG9rZW47CgogICAgaWYgKElkZW50aWZpZXIgPT09IHRva2VuLnR5cGUpIHsKICAgICAgdmFyIHZhcmlhYmxlcyA9IFtdLAogICAgICAgIGluaXQgPSBbXTsKCiAgICAgIGRvIHsKICAgICAgICBuYW1lID0gcGFyc2VJZGVudGlmaWVyKCk7CgogICAgICAgIHZhcmlhYmxlcy5wdXNoKG5hbWUpOwogICAgICAgIGZsb3dDb250ZXh0LmFkZExvY2FsKG5hbWUubmFtZSwgZGVjbFRva2VuKTsKICAgICAgfSB3aGlsZSAoY29uc3VtZSgnLCcpKTsKCiAgICAgIGlmIChjb25zdW1lKCc9JykpIHsKICAgICAgICBkbyB7CiAgICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICAgIGluaXQucHVzaChleHByZXNzaW9uKTsKICAgICAgICB9IHdoaWxlIChjb25zdW1lKCcsJykpOwogICAgICB9CiAgICAgIGlmIChvcHRpb25zLnNjb3BlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YXJpYWJsZXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgICAgICBzY29wZUlkZW50aWZpZXIodmFyaWFibGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5sb2NhbFN0YXRlbWVudCh2YXJpYWJsZXMsIGluaXQpKTsKICAgIH0KICAgIGlmIChjb25zdW1lKCdmdW5jdGlvbicpKSB7CiAgICAgIG5hbWUgPSBwYXJzZUlkZW50aWZpZXIoKTsKICAgICAgZmxvd0NvbnRleHQuYWRkTG9jYWwobmFtZS5uYW1lLCBkZWNsVG9rZW4pOwoKICAgICAgaWYgKG9wdGlvbnMuc2NvcGUpIHsKICAgICAgICBzY29wZUlkZW50aWZpZXIobmFtZSk7CiAgICAgICAgY3JlYXRlU2NvcGUoKTsKICAgICAgfQogICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKG5hbWUsIHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgcmFpc2VVbmV4cGVjdGVkVG9rZW4oJzxuYW1lPicsIHRva2VuKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHBhcnNlQXNzaWdubWVudE9yQ2FsbFN0YXRlbWVudChmbG93Q29udGV4dCkgewogICAgdmFyIHByZXZpb3VzID0gdG9rZW4sCiAgICAgIG1hcmtlciwgc3RhcnRNYXJrZXI7CiAgICB2YXIgbHZhbHVlLCBiYXNlLCBuYW1lOwoKICAgIHZhciB0YXJnZXRzID0gW107CgogICAgaWYgKHRyYWNrTG9jYXRpb25zKSBzdGFydE1hcmtlciA9IGNyZWF0ZUxvY2F0aW9uTWFya2VyKCk7CgogICAgZG8gewogICAgICBpZiAodHJhY2tMb2NhdGlvbnMpIG1hcmtlciA9IGNyZWF0ZUxvY2F0aW9uTWFya2VyKCk7CgogICAgICBpZiAoSWRlbnRpZmllciA9PT0gdG9rZW4udHlwZSkgewogICAgICAgIG5hbWUgPSB0b2tlbi52YWx1ZTsKICAgICAgICBiYXNlID0gcGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgaWYgKG9wdGlvbnMuc2NvcGUpIGF0dGFjaFNjb3BlKGJhc2UsIHNjb3BlSGFzTmFtZShuYW1lKSk7CiAgICAgICAgbHZhbHVlID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICgnKCcgPT09IHRva2VuLnZhbHVlKSB7CiAgICAgICAgbmV4dCgpOwogICAgICAgIGJhc2UgPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgICAgZXhwZWN0KCcpJyk7CiAgICAgICAgbHZhbHVlID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHVuZXhwZWN0ZWQodG9rZW4pOwogICAgICB9CgogICAgICBib3RoOiBmb3IgKDs7KSB7CiAgICAgICAgdmFyIG5ld0Jhc2U7CgogICAgICAgIHN3aXRjaCAoU3RyaW5nTGl0ZXJhbCA9PT0gdG9rZW4udHlwZSA/ICciJyA6IHRva2VuLnZhbHVlKSB7CiAgICAgICAgICBjYXNlICcuJzoKICAgICAgICAgIGNhc2UgJ1snOgogICAgICAgICAgICBsdmFsdWUgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJzonOgogICAgICAgICAgY2FzZSAnKCc6CiAgICAgICAgICBjYXNlICd7JzoKICAgICAgICAgIGNhc2UgJyInOgogICAgICAgICAgICBsdmFsdWUgPSBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrIGJvdGg7CiAgICAgICAgfQoKICAgICAgICBiYXNlID0gcGFyc2VQcmVmaXhFeHByZXNzaW9uUGFydChiYXNlLCBtYXJrZXIsIGZsb3dDb250ZXh0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0cy5wdXNoKGJhc2UpOwoKICAgICAgaWYgKCcsJyAhPT0gdG9rZW4udmFsdWUpCiAgICAgICAgYnJlYWs7CgogICAgICBpZiAoIWx2YWx1ZSkgewogICAgICAgIHJldHVybiB1bmV4cGVjdGVkKHRva2VuKTsKICAgICAgfQoKICAgICAgbmV4dCgpOwogICAgfSB3aGlsZSAodHJ1ZSk7CgogICAgaWYgKHRhcmdldHMubGVuZ3RoID09PSAxICYmIGx2YWx1ZSA9PT0gbnVsbCkgewogICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmNhbGxTdGF0ZW1lbnQodGFyZ2V0c1swXSkpOwogICAgfSBlbHNlIGlmICghbHZhbHVlKSB7CiAgICAgIHJldHVybiB1bmV4cGVjdGVkKHRva2VuKTsKICAgIH0KCiAgICBleHBlY3QoJz0nKTsKCiAgICB2YXIgdmFsdWVzID0gW107CgogICAgZG8gewogICAgICB2YWx1ZXMucHVzaChwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCkpOwogICAgfSB3aGlsZSAoY29uc3VtZSgnLCcpKTsKCiAgICBwdXNoTG9jYXRpb24oc3RhcnRNYXJrZXIpOwogICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmFzc2lnbm1lbnRTdGF0ZW1lbnQodGFyZ2V0cywgdmFsdWVzKSk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZUlkZW50aWZpZXIoKSB7CiAgICBtYXJrTG9jYXRpb24oKTsKICAgIHZhciBpZGVudGlmaWVyID0gdG9rZW4udmFsdWU7CiAgICBpZiAoSWRlbnRpZmllciAhPT0gdG9rZW4udHlwZSkgcmFpc2VVbmV4cGVjdGVkVG9rZW4oJzxuYW1lPicsIHRva2VuKTsKICAgIG5leHQoKTsKICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5pZGVudGlmaWVyKGlkZW50aWZpZXIpKTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb25EZWNsYXJhdGlvbihuYW1lLCBpc0xvY2FsKSB7CiAgICB2YXIgZmxvd0NvbnRleHQgPSBtYWtlRmxvd0NvbnRleHQoKTsKICAgIGZsb3dDb250ZXh0LnB1c2hTY29wZSgpOwoKICAgIHZhciBwYXJhbWV0ZXJzID0gW107CiAgICBleHBlY3QoJygnKTsKICAgIGlmICghY29uc3VtZSgnKScpKSB7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgaWYgKElkZW50aWZpZXIgPT09IHRva2VuLnR5cGUpIHsKICAgICAgICAgIHZhciBwYXJhbWV0ZXIgPSBwYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgIGlmIChvcHRpb25zLnNjb3BlKSBzY29wZUlkZW50aWZpZXIocGFyYW1ldGVyKTsKCiAgICAgICAgICBwYXJhbWV0ZXJzLnB1c2gocGFyYW1ldGVyKTsKCiAgICAgICAgICBpZiAoY29uc3VtZSgnLCcpKSBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKFZhcmFyZ0xpdGVyYWwgPT09IHRva2VuLnR5cGUpIHsKICAgICAgICAgIGZsb3dDb250ZXh0LmFsbG93VmFyYXJnID0gdHJ1ZTsKICAgICAgICAgIHBhcmFtZXRlcnMucHVzaChwYXJzZVByaW1hcnlFeHByZXNzaW9uKGZsb3dDb250ZXh0KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJhaXNlVW5leHBlY3RlZFRva2VuKCc8bmFtZT4gb3IgXCcuLi5cJycsIHRva2VuKTsKICAgICAgICB9CiAgICAgICAgZXhwZWN0KCcpJyk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgYm9keSA9IHBhcnNlQmxvY2soZmxvd0NvbnRleHQpOwogICAgZmxvd0NvbnRleHQucG9wU2NvcGUoKTsKICAgIGV4cGVjdCgnZW5kJyk7CiAgICBpZiAob3B0aW9ucy5zY29wZSkgZGVzdHJveVNjb3BlKCk7CgogICAgaXNMb2NhbCA9IGlzTG9jYWwgfHwgZmFsc2U7CiAgICByZXR1cm4gZmluaXNoTm9kZShhc3QuZnVuY3Rpb25TdGF0ZW1lbnQobmFtZSwgcGFyYW1ldGVycywgaXNMb2NhbCwgYm9keSkpOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VGdW5jdGlvbk5hbWUoKSB7CiAgICB2YXIgYmFzZSwgbmFtZSwgbWFya2VyOwoKICAgIGlmICh0cmFja0xvY2F0aW9ucykgbWFya2VyID0gY3JlYXRlTG9jYXRpb25NYXJrZXIoKTsKICAgIGJhc2UgPSBwYXJzZUlkZW50aWZpZXIoKTsKCiAgICBpZiAob3B0aW9ucy5zY29wZSkgewogICAgICBhdHRhY2hTY29wZShiYXNlLCBzY29wZUhhc05hbWUoYmFzZS5uYW1lKSk7CiAgICAgIGNyZWF0ZVNjb3BlKCk7CiAgICB9CgogICAgd2hpbGUgKGNvbnN1bWUoJy4nKSkgewogICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgbmFtZSA9IHBhcnNlSWRlbnRpZmllcigpOwogICAgICBiYXNlID0gZmluaXNoTm9kZShhc3QubWVtYmVyRXhwcmVzc2lvbihiYXNlLCAnLicsIG5hbWUpKTsKICAgIH0KCiAgICBpZiAoY29uc3VtZSgnOicpKSB7CiAgICAgIHB1c2hMb2NhdGlvbihtYXJrZXIpOwogICAgICBuYW1lID0gcGFyc2VJZGVudGlmaWVyKCk7CiAgICAgIGJhc2UgPSBmaW5pc2hOb2RlKGFzdC5tZW1iZXJFeHByZXNzaW9uKGJhc2UsICc6JywgbmFtZSkpOwogICAgICBpZiAob3B0aW9ucy5zY29wZSkgc2NvcGVJZGVudGlmaWVyTmFtZSgnc2VsZicpOwogICAgfQoKICAgIHJldHVybiBiYXNlOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VUYWJsZUNvbnN0cnVjdG9yKGZsb3dDb250ZXh0KSB7CiAgICB2YXIgZmllbGRzID0gW10sCiAgICAgIGtleSwgdmFsdWU7CgogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbWFya0xvY2F0aW9uKCk7CiAgICAgIGlmIChQdW5jdHVhdG9yID09PSB0b2tlbi50eXBlICYmIGNvbnN1bWUoJ1snKSkgewogICAgICAgIGtleSA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICBleHBlY3QoJ10nKTsKICAgICAgICBleHBlY3QoJz0nKTsKICAgICAgICB2YWx1ZSA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICBmaWVsZHMucHVzaChmaW5pc2hOb2RlKGFzdC50YWJsZUtleShrZXksIHZhbHVlKSkpOwogICAgICB9IGVsc2UgaWYgKElkZW50aWZpZXIgPT09IHRva2VuLnR5cGUpIHsKICAgICAgICBpZiAoJz0nID09PSBsb29rYWhlYWQudmFsdWUpIHsKICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgdmFsdWUgPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgICAgICBmaWVsZHMucHVzaChmaW5pc2hOb2RlKGFzdC50YWJsZUtleVN0cmluZyhrZXksIHZhbHVlKSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWx1ZSA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICAgIGZpZWxkcy5wdXNoKGZpbmlzaE5vZGUoYXN0LnRhYmxlVmFsdWUodmFsdWUpKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChudWxsID09ICh2YWx1ZSA9IHBhcnNlRXhwcmVzc2lvbihmbG93Q29udGV4dCkpKSB7CiAgICAgICAgICBsb2NhdGlvbnMucG9wKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgZmllbGRzLnB1c2goZmluaXNoTm9kZShhc3QudGFibGVWYWx1ZSh2YWx1ZSkpKTsKICAgICAgfQogICAgICBpZiAoJyw7Jy5pbmRleE9mKHRva2VuLnZhbHVlKSA+PSAwKSB7CiAgICAgICAgbmV4dCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgfQogICAgZXhwZWN0KCd9Jyk7CiAgICByZXR1cm4gZmluaXNoTm9kZShhc3QudGFibGVDb25zdHJ1Y3RvckV4cHJlc3Npb24oZmllbGRzKSk7CiAgfQoKICBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24oZmxvd0NvbnRleHQpIHsKICAgIHZhciBleHByZXNzaW9uID0gcGFyc2VTdWJFeHByZXNzaW9uKDAsIGZsb3dDb250ZXh0KTsKICAgIHJldHVybiBleHByZXNzaW9uOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VFeHBlY3RlZEV4cHJlc3Npb24oZmxvd0NvbnRleHQpIHsKICAgIHZhciBleHByZXNzaW9uID0gcGFyc2VFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgIGlmIChudWxsID09IGV4cHJlc3Npb24pIHJhaXNlVW5leHBlY3RlZFRva2VuKCc8ZXhwcmVzc2lvbj4nLCB0b2tlbik7CiAgICBlbHNlIHJldHVybiBleHByZXNzaW9uOwogIH0KCiAgZnVuY3Rpb24gYmluYXJ5UHJlY2VkZW5jZShvcGVyYXRvcikgewogICAgdmFyIGNoYXJDb2RlID0gb3BlcmF0b3IuY2hhckNvZGVBdCgwKSwKICAgICAgbGVuZ3RoID0gb3BlcmF0b3IubGVuZ3RoOwoKICAgIGlmICgxID09PSBsZW5ndGgpIHsKICAgICAgc3dpdGNoIChjaGFyQ29kZSkgewogICAgICAgIGNhc2UgOTQ6CiAgICAgICAgICByZXR1cm4gMTI7CiAgICAgICAgY2FzZSA0MjoKICAgICAgICBjYXNlIDQ3OgogICAgICAgIGNhc2UgMzc6CiAgICAgICAgICByZXR1cm4gMTA7CiAgICAgICAgY2FzZSA0MzoKICAgICAgICBjYXNlIDQ1OgogICAgICAgICAgcmV0dXJuIDk7CiAgICAgICAgY2FzZSAzODoKICAgICAgICAgIHJldHVybiA2OwogICAgICAgIGNhc2UgMTI2OgogICAgICAgICAgcmV0dXJuIDU7CiAgICAgICAgY2FzZSAxMjQ6CiAgICAgICAgICByZXR1cm4gNDsKICAgICAgICBjYXNlIDYwOgogICAgICAgIGNhc2UgNjI6CiAgICAgICAgICByZXR1cm4gMzsKICAgICAgfQogICAgfSBlbHNlIGlmICgyID09PSBsZW5ndGgpIHsKICAgICAgc3dpdGNoIChjaGFyQ29kZSkgewogICAgICAgIGNhc2UgNDc6CiAgICAgICAgICByZXR1cm4gMTA7CiAgICAgICAgY2FzZSA0NjoKICAgICAgICAgIHJldHVybiA4OwogICAgICAgIGNhc2UgNjA6CiAgICAgICAgY2FzZSA2MjoKICAgICAgICAgIGlmICgnPDwnID09PSBvcGVyYXRvciB8fCAnPj4nID09PSBvcGVyYXRvcikgcmV0dXJuIDc7CiAgICAgICAgICByZXR1cm4gMzsKICAgICAgICBjYXNlIDYxOgogICAgICAgIGNhc2UgMTI2OgogICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgfSBlbHNlIGlmICg5NyA9PT0gY2hhckNvZGUgJiYgJ2FuZCcgPT09IG9wZXJhdG9yKSByZXR1cm4gMjsKICAgIHJldHVybiAwOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VTdWJFeHByZXNzaW9uKG1pblByZWNlZGVuY2UsIGZsb3dDb250ZXh0KSB7CiAgICB2YXIgb3BlcmF0b3IgPSB0b2tlbi52YWx1ZSwKICAgICAgZXhwcmVzc2lvbiwgbWFya2VyOwoKICAgIGlmICh0cmFja0xvY2F0aW9ucykgbWFya2VyID0gY3JlYXRlTG9jYXRpb25NYXJrZXIoKTsKICAgIGlmIChpc1VuYXJ5KHRva2VuKSkgewogICAgICBtYXJrTG9jYXRpb24oKTsKICAgICAgbmV4dCgpOwogICAgICB2YXIgYXJndW1lbnQgPSBwYXJzZVN1YkV4cHJlc3Npb24oMTAsIGZsb3dDb250ZXh0KTsKICAgICAgaWYgKGFyZ3VtZW50ID09IG51bGwpIHJhaXNlVW5leHBlY3RlZFRva2VuKCc8ZXhwcmVzc2lvbj4nLCB0b2tlbik7CiAgICAgIGV4cHJlc3Npb24gPSBmaW5pc2hOb2RlKGFzdC51bmFyeUV4cHJlc3Npb24ob3BlcmF0b3IsIGFyZ3VtZW50KSk7CiAgICB9CiAgICBpZiAobnVsbCA9PSBleHByZXNzaW9uKSB7CiAgICAgIGV4cHJlc3Npb24gPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgaWYgKG51bGwgPT0gZXhwcmVzc2lvbikgewogICAgICAgIGV4cHJlc3Npb24gPSBwYXJzZVByZWZpeEV4cHJlc3Npb24oZmxvd0NvbnRleHQpOwogICAgICB9CiAgICB9CiAgICBpZiAobnVsbCA9PSBleHByZXNzaW9uKSByZXR1cm4gbnVsbDsKCiAgICB2YXIgcHJlY2VkZW5jZTsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIG9wZXJhdG9yID0gdG9rZW4udmFsdWU7CgogICAgICBwcmVjZWRlbmNlID0gKFB1bmN0dWF0b3IgPT09IHRva2VuLnR5cGUgfHwgS2V5d29yZCA9PT0gdG9rZW4udHlwZSkgPwogICAgICAgIGJpbmFyeVByZWNlZGVuY2Uob3BlcmF0b3IpIDogMDsKCiAgICAgIGlmIChwcmVjZWRlbmNlID09PSAwIHx8IHByZWNlZGVuY2UgPD0gbWluUHJlY2VkZW5jZSkgYnJlYWs7CiAgICAgIGlmICgnXicgPT09IG9wZXJhdG9yIHx8ICcuLicgPT09IG9wZXJhdG9yKSAtLXByZWNlZGVuY2U7CiAgICAgIG5leHQoKTsKICAgICAgdmFyIHJpZ2h0ID0gcGFyc2VTdWJFeHByZXNzaW9uKHByZWNlZGVuY2UsIGZsb3dDb250ZXh0KTsKICAgICAgaWYgKG51bGwgPT0gcmlnaHQpIHJhaXNlVW5leHBlY3RlZFRva2VuKCc8ZXhwcmVzc2lvbj4nLCB0b2tlbik7CiAgICAgIGlmICh0cmFja0xvY2F0aW9ucykgbG9jYXRpb25zLnB1c2gobWFya2VyKTsKICAgICAgZXhwcmVzc2lvbiA9IGZpbmlzaE5vZGUoYXN0LmJpbmFyeUV4cHJlc3Npb24ob3BlcmF0b3IsIGV4cHJlc3Npb24sIHJpZ2h0KSk7CgogICAgfQogICAgcmV0dXJuIGV4cHJlc3Npb247CiAgfQoKICBmdW5jdGlvbiBwYXJzZVByZWZpeEV4cHJlc3Npb25QYXJ0KGJhc2UsIG1hcmtlciwgZmxvd0NvbnRleHQpIHsKICAgIHZhciBleHByZXNzaW9uLCBpZGVudGlmaWVyOwoKICAgIGlmIChQdW5jdHVhdG9yID09PSB0b2tlbi50eXBlKSB7CiAgICAgIHN3aXRjaCAodG9rZW4udmFsdWUpIHsKICAgICAgICBjYXNlICdbJzoKICAgICAgICAgIHB1c2hMb2NhdGlvbihtYXJrZXIpOwogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgZXhwcmVzc2lvbiA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICAgIGV4cGVjdCgnXScpOwogICAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmluZGV4RXhwcmVzc2lvbihiYXNlLCBleHByZXNzaW9uKSk7CiAgICAgICAgY2FzZSAnLic6CiAgICAgICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIGlkZW50aWZpZXIgPSBwYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5tZW1iZXJFeHByZXNzaW9uKGJhc2UsICcuJywgaWRlbnRpZmllcikpOwogICAgICAgIGNhc2UgJzonOgogICAgICAgICAgcHVzaExvY2F0aW9uKG1hcmtlcik7CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICBpZGVudGlmaWVyID0gcGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgICBiYXNlID0gZmluaXNoTm9kZShhc3QubWVtYmVyRXhwcmVzc2lvbihiYXNlLCAnOicsIGlkZW50aWZpZXIpKTsKICAgICAgICAgIHB1c2hMb2NhdGlvbihtYXJrZXIpOwogICAgICAgICAgcmV0dXJuIHBhcnNlQ2FsbEV4cHJlc3Npb24oYmFzZSwgZmxvd0NvbnRleHQpOwogICAgICAgIGNhc2UgJygnOgogICAgICAgIGNhc2UgJ3snOgogICAgICAgICAgcHVzaExvY2F0aW9uKG1hcmtlcik7CiAgICAgICAgICByZXR1cm4gcGFyc2VDYWxsRXhwcmVzc2lvbihiYXNlLCBmbG93Q29udGV4dCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoU3RyaW5nTGl0ZXJhbCA9PT0gdG9rZW4udHlwZSkgewogICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgcmV0dXJuIHBhcnNlQ2FsbEV4cHJlc3Npb24oYmFzZSwgZmxvd0NvbnRleHQpOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VQcmVmaXhFeHByZXNzaW9uKGZsb3dDb250ZXh0KSB7CiAgICB2YXIgYmFzZSwgbmFtZSwgbWFya2VyOwoKICAgIGlmICh0cmFja0xvY2F0aW9ucykgbWFya2VyID0gY3JlYXRlTG9jYXRpb25NYXJrZXIoKTsKICAgIGlmIChJZGVudGlmaWVyID09PSB0b2tlbi50eXBlKSB7CiAgICAgIG5hbWUgPSB0b2tlbi52YWx1ZTsKICAgICAgYmFzZSA9IHBhcnNlSWRlbnRpZmllcigpOwogICAgICBpZiAob3B0aW9ucy5zY29wZSkgYXR0YWNoU2NvcGUoYmFzZSwgc2NvcGVIYXNOYW1lKG5hbWUpKTsKICAgIH0gZWxzZSBpZiAoY29uc3VtZSgnKCcpKSB7CiAgICAgIGJhc2UgPSBwYXJzZUV4cGVjdGVkRXhwcmVzc2lvbihmbG93Q29udGV4dCk7CiAgICAgIGV4cGVjdCgnKScpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKDs7KSB7CiAgICAgIHZhciBuZXdCYXNlID0gcGFyc2VQcmVmaXhFeHByZXNzaW9uUGFydChiYXNlLCBtYXJrZXIsIGZsb3dDb250ZXh0KTsKICAgICAgaWYgKG5ld0Jhc2UgPT09IG51bGwpCiAgICAgICAgYnJlYWs7CiAgICAgIGJhc2UgPSBuZXdCYXNlOwogICAgfQoKICAgIHJldHVybiBiYXNlOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VDYWxsRXhwcmVzc2lvbihiYXNlLCBmbG93Q29udGV4dCkgewogICAgaWYgKFB1bmN0dWF0b3IgPT09IHRva2VuLnR5cGUpIHsKICAgICAgc3dpdGNoICh0b2tlbi52YWx1ZSkgewogICAgICAgIGNhc2UgJygnOgogICAgICAgICAgaWYgKCFmZWF0dXJlcy5lbXB0eVN0YXRlbWVudCkgewogICAgICAgICAgICBpZiAodG9rZW4ubGluZSAhPT0gcHJldmlvdXNUb2tlbi5saW5lKQogICAgICAgICAgICAgIHJhaXNlKG51bGwsIGVycm9ycy5hbWJpZ3VvdXNTeW50YXgsIHRva2VuLnZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIHZhciBleHByZXNzaW9ucyA9IFtdOwogICAgICAgICAgdmFyIGV4cHJlc3Npb24gPSBwYXJzZUV4cHJlc3Npb24oZmxvd0NvbnRleHQpOwogICAgICAgICAgaWYgKG51bGwgIT0gZXhwcmVzc2lvbikgZXhwcmVzc2lvbnMucHVzaChleHByZXNzaW9uKTsKICAgICAgICAgIHdoaWxlIChjb25zdW1lKCcsJykpIHsKICAgICAgICAgICAgZXhwcmVzc2lvbiA9IHBhcnNlRXhwZWN0ZWRFeHByZXNzaW9uKGZsb3dDb250ZXh0KTsKICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChleHByZXNzaW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICBleHBlY3QoJyknKTsKICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC5jYWxsRXhwcmVzc2lvbihiYXNlLCBleHByZXNzaW9ucykpOwoKICAgICAgICBjYXNlICd7JzoKICAgICAgICAgIG1hcmtMb2NhdGlvbigpOwogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgdmFyIHRhYmxlID0gcGFyc2VUYWJsZUNvbnN0cnVjdG9yKGZsb3dDb250ZXh0KTsKICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKGFzdC50YWJsZUNhbGxFeHByZXNzaW9uKGJhc2UsIHRhYmxlKSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoU3RyaW5nTGl0ZXJhbCA9PT0gdG9rZW4udHlwZSkgewogICAgICByZXR1cm4gZmluaXNoTm9kZShhc3Quc3RyaW5nQ2FsbEV4cHJlc3Npb24oYmFzZSwgcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihmbG93Q29udGV4dCkpKTsKICAgIH0KCiAgICByYWlzZVVuZXhwZWN0ZWRUb2tlbignZnVuY3Rpb24gYXJndW1lbnRzJywgdG9rZW4pOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihmbG93Q29udGV4dCkgewogICAgdmFyIGxpdGVyYWxzID0gU3RyaW5nTGl0ZXJhbCB8IE51bWVyaWNMaXRlcmFsIHwgQm9vbGVhbkxpdGVyYWwgfCBOaWxMaXRlcmFsIHwgVmFyYXJnTGl0ZXJhbCwKICAgICAgdmFsdWUgPSB0b2tlbi52YWx1ZSwKICAgICAgdHlwZSA9IHRva2VuLnR5cGUsCiAgICAgIG1hcmtlcjsKCiAgICBpZiAodHJhY2tMb2NhdGlvbnMpIG1hcmtlciA9IGNyZWF0ZUxvY2F0aW9uTWFya2VyKCk7CgogICAgaWYgKHR5cGUgPT09IFZhcmFyZ0xpdGVyYWwgJiYgIWZsb3dDb250ZXh0LmFsbG93VmFyYXJnKSB7CiAgICAgIHJhaXNlKHRva2VuLCBlcnJvcnMuY2Fubm90VXNlVmFyYXJnLCB0b2tlbi52YWx1ZSk7CiAgICB9CgogICAgaWYgKHR5cGUgJiBsaXRlcmFscykgewogICAgICBwdXNoTG9jYXRpb24obWFya2VyKTsKICAgICAgdmFyIHJhdyA9IGlucHV0LnNsaWNlKHRva2VuLnJhbmdlWzBdLCB0b2tlbi5yYW5nZVsxXSk7CiAgICAgIG5leHQoKTsKICAgICAgcmV0dXJuIGZpbmlzaE5vZGUoYXN0LmxpdGVyYWwodHlwZSwgdmFsdWUsIHJhdykpOwogICAgfSBlbHNlIGlmIChLZXl3b3JkID09PSB0eXBlICYmICdmdW5jdGlvbicgPT09IHZhbHVlKSB7CiAgICAgIHB1c2hMb2NhdGlvbihtYXJrZXIpOwogICAgICBuZXh0KCk7CiAgICAgIGlmIChvcHRpb25zLnNjb3BlKSBjcmVhdGVTY29wZSgpOwogICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKG51bGwpOwogICAgfSBlbHNlIGlmIChjb25zdW1lKCd7JykpIHsKICAgICAgcHVzaExvY2F0aW9uKG1hcmtlcik7CiAgICAgIHJldHVybiBwYXJzZVRhYmxlQ29uc3RydWN0b3IoZmxvd0NvbnRleHQpOwogICAgfQogIH0KCiAgZXhwb3J0cy5wYXJzZSA9IHBhcnNlOwoKICB2YXIgdmVyc2lvbkZlYXR1cmVzID0gewogICAgJzUuMSc6IHt9LAogICAgJzUuMic6IHsKICAgICAgbGFiZWxzOiB0cnVlLAogICAgICBlbXB0eVN0YXRlbWVudDogdHJ1ZSwKICAgICAgaGV4RXNjYXBlczogdHJ1ZSwKICAgICAgc2tpcFdoaXRlc3BhY2VFc2NhcGU6IHRydWUsCiAgICAgIHN0cmljdEVzY2FwZXM6IHRydWUsCiAgICAgIHJlbGF4ZWRCcmVhazogdHJ1ZQogICAgfSwKICAgICc1LjMnOiB7CiAgICAgIGxhYmVsczogdHJ1ZSwKICAgICAgZW1wdHlTdGF0ZW1lbnQ6IHRydWUsCiAgICAgIGhleEVzY2FwZXM6IHRydWUsCiAgICAgIHNraXBXaGl0ZXNwYWNlRXNjYXBlOiB0cnVlLAogICAgICBzdHJpY3RFc2NhcGVzOiB0cnVlLAogICAgICB1bmljb2RlRXNjYXBlczogdHJ1ZSwKICAgICAgYml0d2lzZU9wZXJhdG9yczogdHJ1ZSwKICAgICAgaW50ZWdlckRpdmlzaW9uOiB0cnVlLAogICAgICByZWxheGVkQnJlYWs6IHRydWUKICAgIH0sCiAgICAnTHVhSklUJzogewogICAgICBsYWJlbHM6IHRydWUsCiAgICAgIGNvbnRleHR1YWxHb3RvOiB0cnVlLAogICAgICBoZXhFc2NhcGVzOiB0cnVlLAogICAgICBza2lwV2hpdGVzcGFjZUVzY2FwZTogdHJ1ZSwKICAgICAgc3RyaWN0RXNjYXBlczogdHJ1ZSwKICAgICAgdW5pY29kZUVzY2FwZXM6IHRydWUKICAgIH0KICB9OwoKICBmdW5jdGlvbiBwYXJzZShfaW5wdXQsIF9vcHRpb25zKSB7CiAgICBpZiAoJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBfb3B0aW9ucyAmJiAnb2JqZWN0JyA9PT0gdHlwZW9mIF9pbnB1dCkgewogICAgICBfb3B0aW9ucyA9IF9pbnB1dDsKICAgICAgX2lucHV0ID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKCFfb3B0aW9ucykgX29wdGlvbnMgPSB7fTsKCiAgICBpbnB1dCA9IF9pbnB1dCB8fCAnJzsKICAgIG9wdGlvbnMgPSBhc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBfb3B0aW9ucyk7CiAgICBpbmRleCA9IDA7CiAgICBsaW5lID0gMTsKICAgIGxpbmVTdGFydCA9IDA7CiAgICBsZW5ndGggPSBpbnB1dC5sZW5ndGg7CiAgICBzY29wZXMgPSBbCiAgICAgIFtdCiAgICBdOwogICAgc2NvcGVEZXB0aCA9IDA7CiAgICBnbG9iYWxzID0gW107CiAgICBsb2NhdGlvbnMgPSBbXTsKCiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh2ZXJzaW9uRmVhdHVyZXMsIG9wdGlvbnMubHVhVmVyc2lvbikpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHNwcmludGYoIkx1YSB2ZXJzaW9uICclMScgbm90IHN1cHBvcnRlZCIsIG9wdGlvbnMubHVhVmVyc2lvbikpOwogICAgfQoKICAgIGZlYXR1cmVzID0gYXNzaWduKHt9LCB2ZXJzaW9uRmVhdHVyZXNbb3B0aW9ucy5sdWFWZXJzaW9uXSk7CiAgICBpZiAob3B0aW9ucy5leHRlbmRlZElkZW50aWZpZXJzICE9PSB2b2lkIDApCiAgICAgIGZlYXR1cmVzLmV4dGVuZGVkSWRlbnRpZmllcnMgPSAhIW9wdGlvbnMuZXh0ZW5kZWRJZGVudGlmaWVyczsKCiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlbmNvZGluZ01vZGVzLCBvcHRpb25zLmVuY29kaW5nTW9kZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHNwcmludGYoIkVuY29kaW5nIG1vZGUgJyUxJyBub3Qgc3VwcG9ydGVkIiwgb3B0aW9ucy5lbmNvZGluZ01vZGUpKTsKICAgIH0KCiAgICBlbmNvZGluZ01vZGUgPSBlbmNvZGluZ01vZGVzW29wdGlvbnMuZW5jb2RpbmdNb2RlXTsKCiAgICBpZiAob3B0aW9ucy5jb21tZW50cykgY29tbWVudHMgPSBbXTsKICAgIGlmICghb3B0aW9ucy53YWl0KSByZXR1cm4gZW5kKCk7CiAgICByZXR1cm4gZXhwb3J0czsKICB9CiAgZXhwb3J0cy53cml0ZSA9IHdyaXRlOwoKICBmdW5jdGlvbiB3cml0ZShfaW5wdXQpIHsKICAgIGlucHV0ICs9IFN0cmluZyhfaW5wdXQpOwogICAgbGVuZ3RoID0gaW5wdXQubGVuZ3RoOwogICAgcmV0dXJuIGV4cG9ydHM7CiAgfQogIGV4cG9ydHMuZW5kID0gZW5kOwoKICBmdW5jdGlvbiBlbmQoX2lucHV0KSB7CiAgICBpZiAoJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBfaW5wdXQpIHdyaXRlKF9pbnB1dCk7CiAgICBpZiAoaW5wdXQgJiYgaW5wdXQuc3Vic3RyKDAsIDIpID09PSAnIyEnKSBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL14uKi8sIGZ1bmN0aW9uIChsaW5lKSB7CiAgICAgIHJldHVybiBsaW5lLnJlcGxhY2UoLy4vZywgJyAnKTsKICAgIH0pOwoKICAgIGxlbmd0aCA9IGlucHV0Lmxlbmd0aDsKICAgIHRyYWNrTG9jYXRpb25zID0gb3B0aW9ucy5sb2NhdGlvbnMgfHwgb3B0aW9ucy5yYW5nZXM7CiAgICBsb29rYWhlYWQgPSBsZXgoKTsKCiAgICB2YXIgY2h1bmsgPSBwYXJzZUNodW5rKCk7CiAgICBpZiAob3B0aW9ucy5jb21tZW50cykgY2h1bmsuY29tbWVudHMgPSBjb21tZW50czsKICAgIGlmIChvcHRpb25zLnNjb3BlKSBjaHVuay5nbG9iYWxzID0gZ2xvYmFsczsKICAgIGlmIChsb2NhdGlvbnMubGVuZ3RoID4gMCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhdGlvbiB0cmFja2luZyBmYWlsZWQuIFRoaXMgaXMgbW9zdCBsaWtlbHkgYSBidWcgaW4gbHVhcGFyc2UnKTsKCiAgICByZXR1cm4gY2h1bms7CiAgfQoKfSkpOwoJPC9zY3JpcHQ+CgoJPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCQlodG1sLAoJCWJvZHkgewoJCQl3aWR0aDogMTAwJTsKCQkJaGVpZ2h0OiAxMDAlOwoJCQltYXJnaW46IDA7CgkJCXBhZGRpbmc6IDA7CgkJCW92ZXJmbG93OiBoaWRkZW47CgkJfQoJPC9zdHlsZT4KCTxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgoJPHRpdGxlPjwvdGl0bGU+CjwvaGVhZD4KCjxib2R5PgogIDxkaXYgY2xhc3M9ImVkaXRvci1jb250YWluZXIiPgogICAgICA8ZGl2IGlkPSJ0YWJzLWNvbnRhaW5lciIgY2xhc3M9InRhYnMtY29udGFpbmVyIj48L2Rpdj4KICAgICAgPGRpdiBpZD0iY29udGFpbmVyIiBzdHlsZT0id2lkdGg6MTAwJTtoZWlnaHQ6Y2FsYygxMDAlIC0gMzVweCk7Ij48L2Rpdj4KICA8L2Rpdj4KICA8c3R5bGU+CiAgICAgIC5lZGl0b3ItY29udGFpbmVyIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIH0KICAgICAgLnRhYnMtY29udGFpbmVyIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgLyogQ8OhYyBkw7JuZyBraMOhYyBnaeG7ryBuZ3V5w6puICovCiAgICBkaXNwbGF5OiBmbGV4OwogICAgaGVpZ2h0OiAzNXB4OwogICAgb3ZlcmZsb3cteDogYXV0bzsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMzMzOwogICAgZ2FwOiAwOwp9CiNjb250YWluZXIgewogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KICAgICAgLnRhYiB7CiAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgIHBhZGRpbmc6IDAgMTVweDsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxRjFGMUY7CiAgICAgICAgICBjb2xvcjogIzk2OTY5NjsKICAgICAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICMxRjFGMUY7CiAgICAgICAgICBtaW4td2lkdGg6IDEyMHB4OwogICAgICAgICAgbWF4LXdpZHRoOiAyMDBweDsKICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgMC4ycywgY29sb3IgMC4yczsKICAgICAgICAgIHVzZXItc2VsZWN0OiBub25lOwogICAgICB9CiAgICAgICAgICAudGFiLmFjdGl2ZSB7CiAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7CiAgICAgICAgICB9CiAgICAgIC50YWItaWNvbiB7CiAgICAgICAgICB3aWR0aDogMjBweDsKICAgICAgICAgIGhlaWdodDogMjBweDsKICAgICAgICAgIG1hcmdpbi1yaWdodDogOHB4OwogICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgCiAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7IAogICAgICAgICAgdG9wOiAycHg7CiAgICAgIH0KICAgICAgLnRhYi1pY29uIHN2ZyB7CiAgICAgICAgICB3aWR0aDogMTZweDsKICAgICAgICAgIGhlaWdodDogMTZweDsKICAgICAgfQogICAgICAudGFiLXRpdGxlIHsKICAgICAgICAgIGZsZXgtZ3JvdzogMTsKICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgICBmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAnU2Vnb2UgVUknLCBSb2JvdG8sIE94eWdlbiwgVWJ1bnR1LCBDYW50YXJlbGwsICdPcGVuIFNhbnMnLCAnSGVsdmV0aWNhIE5ldWUnLCBzYW5zLXNlcmlmOwogICAgICB9CiAgICAgIC50YWItdGl0bGUuZWRpdGluZyB7CiAgICAgICAgICBiYWNrZ3JvdW5kOiAjM2QzZDNkOwogICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgIzUyNTI1MjsKICAgICAgICAgIHBhZGRpbmc6IDJweCA0cHg7CiAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICB9CiAgICAgIC50YWItY2xvc2UgewogICAgICAgICAgbWFyZ2luLWxlZnQ6IDhweDsKICAgICAgICAgIG9wYWNpdHk6IDAuNzsKICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4yczsKICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICB3aWR0aDogMTZweDsKICAgICAgICAgIGhlaWdodDogMTZweDsKICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgfQogICAgICAudGFiLWNsb3NlOmhvdmVyIHsKICAgICAgICAgIG9wYWNpdHk6IDE7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuMSk7CiAgICAgIH0KICAgICAgLnRhYi5uZXctdGFiIHsKICAgICAgICAgIG1pbi13aWR0aDogMTBweDsKICAgICAgICAgIG1heC13aWR0aDogMTBweDsKICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICBtYXJnaW4tbGVmdDogLTJweDsKICAgICAgfQogICAgICAudGFiLm5ldy10YWI6aG92ZXIgewogICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjEpOwogICAgICB9CiAgICAgIEBrZXlmcmFtZXMgdGFiQXBwZWFyIHsKICAgICAgICAgIGZyb20gewogICAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xMHB4KTsKICAgICAgICAgIH0KICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBAa2V5ZnJhbWVzIHRhYlJlbW92ZSB7CiAgICAgICAgICB0byB7CiAgICAgICAgICAgICAgb3BhY2l0eTogMDsKICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEwcHgpOwogICAgICAgICAgfQogICAgICB9CiAgICAgIC50YWIubmV3IHsKICAgICAgICAgIGFuaW1hdGlvbjogdGFiQXBwZWFyIDAuMnMgZWFzZS1vdXQ7CiAgICAgIH0KICAgICAgLnRhYi5yZW1vdmluZyB7CiAgICAgICAgICBhbmltYXRpb246IHRhYlJlbW92ZSAwLjJzIGVhc2Utb3V0OwogICAgICB9CiAgPC9zdHlsZT4KICA8c2NyaXB0IHNyYz0idnMvbG9hZGVyLmpzIj48L3NjcmlwdD4KICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAgIHJlcXVpcmUuY29uZmlnKHsKICAgICAgICAgIHBhdGhzOiB7CiAgICAgICAgICAgICAgJ3ZzJzogJ3ZzJwogICAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGxldCBlZGl0b3I7CiAgICAgIGxldCBQcm9wb3NhbHMgPSBbXTsKICAgICAgbGV0IGN1cnJlbnRUYWIgPSBudWxsOwogICAgICBsZXQgdGFicyA9IFtdOwoKICAgICAgY29uc3QgbHVhSWNvbiA9IGA8aW1nIHNyYz0iYmlnc2l6ZS5wbmciIGFsdD0iTHVhIEljb24iIHN0eWxlPSJ3aWR0aDogMjBweDsgaGVpZ2h0OiAyMHB4OyIgLz5gOwoKICAgICAgICBjbGFzcyBUYWIgewogICAgICAgICAgICBjb25zdHJ1Y3Rvcih0aXRsZSwgY29udGVudCA9ICcnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlkID0gJ3RhYi0nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpOwogICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlOwogICAgICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNhdmVUYWJzKCkgewogICAgICAgICAgY29uc3QgdGFic0RhdGEgPSB0YWJzLm1hcCh0YWIgPT4gKHsKICAgICAgICBpZDogdGFiLmlkLAogICAgICAgIHRpdGxlOiB0YWIudGl0bGUsCiAgICAgICAgY29udGVudDogdGFiLmNvbnRlbnQKICAgIH0pKTsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdlZGl0b3JUYWJzJywgSlNPTi5zdHJpbmdpZnkodGFic0RhdGEpKTsKfQpmdW5jdGlvbiBsb2FkVGFicygpIHsKICAgIGNvbnN0IHNhdmVkVGFicyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdlZGl0b3JUYWJzJyk7CiAgICBpZiAoc2F2ZWRUYWJzKSB7CiAgICAgICAgY29uc3QgdGFic0RhdGEgPSBKU09OLnBhcnNlKHNhdmVkVGFicyk7CiAgICAgICAgdGFic0RhdGEuZm9yRWFjaCh0YWJEYXRhID0+IHsKICAgICAgICAgICAgYWRkVGFiKHRhYkRhdGEudGl0bGUsIHRhYkRhdGEuY29udGVudCwgdGFiRGF0YS5pZCk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGFkZFRhYignTmV3IFRhYiAxJyk7IAogICAgfQp9CgogICAgICAgIGZ1bmN0aW9uIG1ha2VFZGl0YWJsZSh0aXRsZUVsZW1lbnQsIHRhYikgewogICAgICAgICAgICB0aXRsZUVsZW1lbnQuY29udGVudEVkaXRhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgdGl0bGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2VkaXRpbmcnKTsKICAgICAgICAgICAgdGl0bGVFbGVtZW50LmZvY3VzKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyh0aXRsZUVsZW1lbnQpOwogICAgICAgICAgICBjb25zdCBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CiAgICAgICAgICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTsKICAgICAgICAgICAgc2VsLmFkZFJhbmdlKHJhbmdlKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaEVkaXRpbmcoKSB7CiAgICAgICAgICAgICAgICB0aXRsZUVsZW1lbnQuY29udGVudEVkaXRhYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aXRsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZWRpdGluZycpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3VGl0bGUgPSB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgaWYgKG5ld1RpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgdGFiLnRpdGxlID0gbmV3VGl0bGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRhYi50aXRsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGl0bGVFbGVtZW50Lm9uYmx1ciA9IGZpbmlzaEVkaXRpbmc7CiAgICAgICAgICAgIHRpdGxlRWxlbWVudC5vbmtleWRvd24gPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInKSB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGZpbmlzaEVkaXRpbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0YWIudGl0bGU7CiAgICAgICAgICAgICAgICAgICAgZmluaXNoRWRpdGluZygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGFiRWxlbWVudCh0YWIpIHsKICAgICAgICAgICAgY29uc3QgdGFiRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICB0YWJFbGVtZW50LmNsYXNzTmFtZSA9ICd0YWIgbmV3JzsKICAgICAgICAgICAgdGFiRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFiLWlkJywgdGFiLmlkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGljb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGljb25FbGVtZW50LmNsYXNzTmFtZSA9ICd0YWItaWNvbic7CiAgICAgICAgICAgIGljb25FbGVtZW50LmlubmVySFRNTCA9IGx1YUljb247CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgdGl0bGVFbGVtZW50LmNsYXNzTmFtZSA9ICd0YWItdGl0bGUnOwogICAgICAgICAgICB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0YWIudGl0bGU7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aXRsZUVsZW1lbnQub25kYmxjbGljayA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgbWFrZUVkaXRhYmxlKHRpdGxlRWxlbWVudCwgdGFiKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGNsb3NlQnV0dG9uLmNsYXNzTmFtZSA9ICd0YWItY2xvc2UnOwogICAgICAgICAgICBjbG9zZUJ1dHRvbi5pbm5lckhUTUwgPSAn4pyVJzsKICAgICAgICAgICAgY2xvc2VCdXR0b24ub25jbGljayA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKHRhYnMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZVRhYih0YWIuaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGFiRWxlbWVudC5hcHBlbmRDaGlsZChpY29uRWxlbWVudCk7CiAgICAgICAgICAgIHRhYkVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGVFbGVtZW50KTsKICAgICAgICAgICAgdGFiRWxlbWVudC5hcHBlbmRDaGlsZChjbG9zZUJ1dHRvbik7CiAgICAgICAgICAgIAogICAgICAgICAgICB0YWJFbGVtZW50Lm9uY2xpY2sgPSAoKSA9PiBzd2l0Y2hUYWIodGFiLmlkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0YWJFbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTmV3VGFiQnV0dG9uKCkgewogICAgICAgICAgICBjb25zdCBuZXdUYWJCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgbmV3VGFiQnV0dG9uLmNsYXNzTmFtZSA9ICd0YWIgbmV3LXRhYic7CiAgICAgICAgICAgIG5ld1RhYkJ1dHRvbi5pbm5lckhUTUwgPSAnKyc7CiAgICAgICAgICAgIG5ld1RhYkJ1dHRvbi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmV3VGFiID0gYWRkVGFiKCdOZXcgVGFiICcgKyAodGFicy5sZW5ndGggKyAxKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBuZXdUYWJCdXR0b247CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRUYWIodGl0bGUsIGNvbnRlbnQgPSAnJywgaWQgPSBudWxsKSB7CiAgICBjb25zdCB0YWIgPSBuZXcgVGFiKHRpdGxlLCBjb250ZW50KTsKICAgIGlmIChpZCkgdGFiLmlkID0gaWQ7CiAgICB0YWJzLnB1c2godGFiKTsKICAgIAogICAgY29uc3QgdGFic0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJzLWNvbnRhaW5lcicpOwogICAgY29uc3QgbmV3VGFiQnV0dG9uID0gdGFic0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcubmV3LXRhYicpOwogICAgCiAgICB0YWIuZWxlbWVudCA9IGNyZWF0ZVRhYkVsZW1lbnQodGFiKTsKICAgIGlmIChuZXdUYWJCdXR0b24pIHsKICAgICAgICB0YWJzQ29udGFpbmVyLmluc2VydEJlZm9yZSh0YWIuZWxlbWVudCwgbmV3VGFiQnV0dG9uKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGFic0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWIuZWxlbWVudCk7CiAgICAgICAgdGFic0NvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVOZXdUYWJCdXR0b24oKSk7CiAgICB9CiAgICAKICAgIHN3aXRjaFRhYih0YWIuaWQpOwogICAgc2F2ZVRhYnMoKTsKICAgIHJldHVybiB0YWI7Cn0KCmZ1bmN0aW9uIHJlbW92ZVRhYih0YWJJZCkgewogICAgY29uc3QgdGFiSW5kZXggPSB0YWJzLmZpbmRJbmRleCh0ID0+IHQuaWQgPT09IHRhYklkKTsKICAgIGlmICh0YWJJbmRleCA9PT0gLTEpIHJldHVybjsKICAgIAogICAgaWYgKHRhYnMubGVuZ3RoIDw9IDEpIHJldHVybjsKICAgIAogICAgY29uc3QgdGFiID0gdGFic1t0YWJJbmRleF07CiAgICB0YWIuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdyZW1vdmluZycpOwogICAgCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0YWJzLnNwbGljZSh0YWJJbmRleCwgMSk7CiAgICAgICAgdGFiLmVsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgCiAgICAgICAgaWYgKGN1cnJlbnRUYWIgPT09IHRhYklkKSB7CiAgICAgICAgICAgIHN3aXRjaFRhYih0YWJzW01hdGgubWluKHRhYkluZGV4LCB0YWJzLmxlbmd0aCAtIDEpXS5pZCk7CiAgICAgICAgfQogICAgICAgIHNhdmVUYWJzKCk7CiAgICB9LCAyMDApOwp9CmZ1bmN0aW9uIHN3aXRjaFRhYih0YWJJZCkgewogICAgY29uc3QgdGFiID0gdGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFiSWQpOwogICAgaWYgKCF0YWIpIHJldHVybjsKICAgIAogICAgdGFicy5mb3JFYWNoKHQgPT4gewogICAgICAgIGlmICh0LmVsZW1lbnQpIHsKICAgICAgICAgICAgdC5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICBpZiAoY3VycmVudFRhYiAhPT0gdGFiSWQpIHsKICAgICAgICBpZiAoY3VycmVudFRhYikgewogICAgICAgICAgICBjb25zdCBvbGRUYWIgPSB0YWJzLmZpbmQodCA9PiB0LmlkID09PSBjdXJyZW50VGFiKTsKICAgICAgICAgICAgaWYgKG9sZFRhYikgewogICAgICAgICAgICAgICAgb2xkVGFiLmNvbnRlbnQgPSBlZGl0b3IuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIHNhdmVUYWJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZWRpdG9yLnNldFZhbHVlKHRhYi5jb250ZW50KTsKICAgICAgICB0YWIuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICBjdXJyZW50VGFiID0gdGFiSWQ7CiAgICB9Cn0KCmZ1bmN0aW9uIHNldHVwQXV0b3NhdmUoKSB7CiAgICBsZXQgc2F2ZVRpbWVvdXQ7CiAgICBlZGl0b3Iub25EaWRDaGFuZ2VNb2RlbENvbnRlbnQoKCkgPT4gewogICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dCk7CiAgICAgICAgc2F2ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRUYWIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhYiA9IHRhYnMuZmluZCh0ID0+IHQuaWQgPT09IGN1cnJlbnRUYWIpOwogICAgICAgICAgICAgICAgaWYgKHRhYikgewogICAgICAgICAgICAgICAgICAgIHRhYi5jb250ZW50ID0gZWRpdG9yLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVRhYnMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIDEpOyAKICAgIH0pOwp9CgoKICAgIHZhciBlbmFibGVBbnRpU2tpZDsKICAgIHZhciBkaXNhYmxlQW50aVNraWQ7CgkJdmFyIFNldFRleHQ7CgkJdmFyIFNob3dNaW5pbWFwOwoJCXZhciBIaWRlTWluaW1hcDsKCQl2YXIgRW5hYmxlQXV0b0NvbXBsZXRlOwoJCXZhciBEaXNhYmxlQXV0b0NvbXBsZXRlOwoJCXZhciBHZXRUZXh0OwoJCXZhciBBZGRJbnRlbGxpc2Vuc2U7CgkJdmFyIFJlZnJlc2g7CgkKCgoJCXJlcXVpcmUoWyd2cy9lZGl0b3IvZWRpdG9yLm1haW4nXSwgZnVuY3Rpb24gKCkgewoJCQlmdW5jdGlvbiBnZXREZXBlbmRlbmN5UHJvcG9zYWxzKCkgewoJCQkJcmV0dXJuIFByb3Bvc2FsczsKCQkJfQoKCQkJbW9uYWNvLmxhbmd1YWdlcy5yZWdpc3RlckNvbXBsZXRpb25JdGVtUHJvdmlkZXIoJ2x1YScsIHsKCQkJCXByb3ZpZGVDb21wbGV0aW9uSXRlbXM6IGZ1bmN0aW9uIChtb2RlbCwgcG9zaXRpb24pIHsKCQkJCQlyZXR1cm4gZ2V0RGVwZW5kZW5jeVByb3Bvc2FscygpOwoJCQkJfSwKCQkJCXRyaWdnZXJDaGFyYWN0ZXJzOiBbJy4nLCAnOicsICciJ10sCgkJCX0pOwoKCQkJCgkJCW1vbmFjby5lZGl0b3IuZGVmaW5lVGhlbWUoJ25ldC10aGVtZS1kYXJrJywgewoJCQkJYmFzZTogJ3ZzLWRhcmsnLAoJCQkJaW5oZXJpdDogdHJ1ZSwKCQkJCWNvbG9yczogewoJCQkJCSJlZGl0b3IuYmFja2dyb3VuZCI6ICIjMDAwMDAwMDAiLCAvL3VyIGJhY2tncm91bmQgY29sb3IKCQkJCX0sCgkJCQlydWxlczogW3sKCQkJCQkJdG9rZW46ICdnbG9iYWwnLAoJCQkJCQlmb3JlZ3JvdW5kOiAnNjY5OWNjJywgLy8gLy9GRkZGRkYKCQkJCQkJZm9udFN0eWxlOiAiYm9sZCIKCQkJCQl9LAoJCQkJCXsKCQkJCQkJdG9rZW46ICdrZXl3b3JkJywKCQkJCQkJZm9yZWdyb3VuZDogJ2NjOTljYycsCgkJCQkJCWZvbnRTdHlsZTogImJvbGQiCgkJCQkJfSwKCQkJCQl7CgkJCQkJCXRva2VuOiAnY29tbWVudCcsCgkJCQkJCWZvcmVncm91bmQ6ICc5OTk5OTknCgkJCQkJfSwKCQkJCQl7CgkJCQkJCXRva2VuOiAnbnVtYmVyJywKCQkJCQkJZm9yZWdyb3VuZDogJ2Y5OTE1NycKCQkJCQl9LAoJCQkJCXsKCQkJCQkJdG9rZW46ICdzdHJpbmcnLAoJCQkJCQlmb3JlZ3JvdW5kOiAnOTlDQzk5JwoJCQkJCX0sCgkJCQkJewoJCQkJCQl0b2tlbjogJ01ldGhvZCcsCgkJCQkJCWZvcmVncm91bmQ6ICdmZmExZGMnCgkJCQkJfSwKCQkJCV0KCQkJfSk7CgoJCQllZGl0b3IgPSBtb25hY28uZWRpdG9yLmNyZWF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksIHsKCQkJCWxhbmd1YWdlOiAnbHVhJywKCQkJCXRoZW1lOiAibmV0LXRoZW1lLWRhcmsiLAoJCQkJYWNjZXB0U3VnZ2VzdGlvbk9uRW50ZXI6ICJzbWFydCIsCgkJCQljdXJzb3JTbW9vdGhDYXJldEFuaW1hdGlvbjogdHJ1ZSwKCQkJCXN1Z2dlc3RPblRyaWdnZXJDaGFyYWN0ZXJzOiB0cnVlLAoJCQkJc3VnZ2VzdFNlbGVjdGlvbjogInJlY2VudGx5VXNlZCIsCgkJCQlmb2xkaW5nOiB0cnVlLAoJCQkJCWRyYWdBbmREcm9wOiB0cnVlLAoJCQkJCWxpbmtzOiBmYWxzZSwKCQkJCQltaW5pbWFwOiB7CgkJCQkJCWVuYWJsZWQ6IGZhbHNlLAoJCQkJCX0sCgkJCQkJc2hvd0ZvbGRpbmdDb250cm9sczogImFsd2F5cyIsCgkJCQkJc21vb3RoU2Nyb2xsaW5nOiB0cnVlLAoJCQkJCXN0b3BSZW5kZXJpbmdMaW5lQWZ0ZXI6IDY1MDAsCgkJCQkJY3Vyc29yQmxpbmtpbmc6ICJzbW9vdGgiLAoJCQkJCWN1cnNvclNtb290aENhcmV0QW5pbWF0aW9uOiB0cnVlLAoJCQkJCWZvbGRpbmdIaWdobGlnaHQ6IGZhbHNlLAoJCQkJCWZvbnRMaWdhdHVyZXM6IHRydWUsCgkJCQkJZm9ybWF0T25QYXN0ZTogdHJ1ZSwKCQkJCQlzaG93RGVwcmVjYXRlZDogdHJ1ZSwKCQkJCQlzdWdnZXN0OiB7CgkJCQkJCXNuaXBwZXRzUHJldmVudFF1aWNrU3VnZ2VzdGlvbnM6IGZhbHNlLAoJCQkJCX0sCgkJCQkJcGFkZGluZzogewoJCQkJCQl0b3A6IDI0LAoJCQkJCX0KCQkJfSk7CgogICAgICBsb2FkVGFicygpOwogICAgICBzZXR1cEF1dG9zYXZlKCk7CgoJCQlFbmFibGVBdXRvQ29tcGxldGUgPSBmdW5jdGlvbigpewoJCQkJZWRpdG9yLnVwZGF0ZU9wdGlvbnMoewoJCQkJCXN1Z2dlc3RPblRyaWdnZXJDaGFyYWN0ZXJzOiB0cnVlLAoJCQkJCWFjY2VwdFN1Z2dlc3Rpb25PbkVudGVyIDogInNtYXJ0IiwKCQkJCQl3b3JkQmFzZWRTdWdnZXN0aW9ucyA6IHRydWUKCQkJCX0pOwoJCQl9CgoJCQlEaXNhYmxlQXV0b0NvbXBsZXRlID0gZnVuY3Rpb24oKXsKCQkJCWVkaXRvci51cGRhdGVPcHRpb25zKHsKCQkJCQlzdWdnZXN0T25UcmlnZ2VyQ2hhcmFjdGVyczogZmFsc2UsCgkJCQkJYWNjZXB0U3VnZ2VzdGlvbk9uRW50ZXIgOiAib2ZmIiwKCQkJCQl3b3JkQmFzZWRTdWdnZXN0aW9ucyA6IGZhbHNlCgkJCQl9KTsKCQkJfQoKCQkJd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24gKCkgewoJCQkJZWRpdG9yLmxheW91dCgpOwoJCQl9OwogICAKCQkJU2hvd01pbmltYXAgPSBmdW5jdGlvbiAoKSB7CgkJCQllZGl0b3IudXBkYXRlT3B0aW9ucyh7CgkJCQkJbWluaW1hcDogewoJCQkJCQllbmFibGVkOiB0cnVlLAoJCQkJCX0KCQkJCX0pOwoJCQl9CgoJCQlIaWRlTWluaW1hcCA9IGZ1bmN0aW9uICgpIHsKCQkJCWVkaXRvci51cGRhdGVPcHRpb25zKHsKCQkJCQltaW5pbWFwOiB7CgkJCQkJCWVuYWJsZWQ6IGZhbHNlLAoJCQkJCX0KCQkJCX0pOwoJCQl9CgogICAgICBmdW5jdGlvbiBoYW5kbGVvdmVyKCkKICAgICAgewogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuZmlsdGVyID0gImJsdXIoMHB4KSIKICAgICAgfQogICAgICBmdW5jdGlvbiBoYW5kbGVsZWF2ZSgpCiAgICAgIHsKICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmZpbHRlciA9ICJibHVyKDVweCkiCiAgICAgIH0KICAgICAgZW5hYmxlQW50aVNraWQ9IGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuZmlsdGVyID0gImJsdXIoNXB4KSI7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLGhhbmRsZW92ZXIpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VsZWF2ZSIsaGFuZGxlbGVhdmUpOwogICAgICB9CiAgICAgIGRpc2FibGVBbnRpU2tpZCA9IGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuZmlsdGVyID0gImJsdXIoMHB4KSI7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLGhhbmRsZW92ZXIsZmFsc2UpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2VsZWF2ZSIsaGFuZGxlbGVhdmUsZmFsc2UpOwogICAgICAgIAogICAgICB9CiAgICAgIGVkaXRvci5vbkRpZENoYW5nZU1vZGVsQ29udGVudChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5sdWFwYXJzZS5wYXJzZShlZGl0b3IuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICBtb25hY28uZWRpdG9yLnNldE1vZGVsTWFya2VycyhlZGl0b3IuZ2V0TW9kZWwoKSwnbHVhcGFyc2UnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaChFcnIpIHsKICAgICAgICAgICAgICAgIG1vbmFjby5lZGl0b3Iuc2V0TW9kZWxNYXJrZXJzKGVkaXRvci5nZXRNb2RlbCgpLCdsdWFwYXJzZScsW3sKICAgICAgICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXI6IEVyci5saW5lLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sdW1uOiBFcnIuY29sdW1uLAogICAgICAgICAgICAgICAgICAgIGVuZExpbmVOdW1iZXI6IEVyci5saW5lLAogICAgICAgICAgICAgICAgICAgIGVuZENvbHVtbjogRXJyLmNvbHVtbiwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBFcnIubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBzZXZlcml0eTogMwogICAgICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgkJCUdldFRleHQgPSBmdW5jdGlvbiAoKSB7CgkJCQlyZXR1cm4gZWRpdG9yLmdldFZhbHVlKCk7CgkJCX0KCgkJCVNldFRleHQgPSBmdW5jdGlvbiAoeCkgewoJCQkJZWRpdG9yLnNldFZhbHVlKHgpOwoJCQl9CgoJCQlBZGRJbnRlbGxpc2Vuc2UgPSBmdW5jdGlvbiAobCwgaywgZCwgaSkgewoJCQkJdmFyIHQ7CgkJCQlzd2l0Y2ggKGspIHsKCQkJCQljYXNlICJDbGFzcyI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5DbGFzczsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiQ29sb3IiOgoJCQkJCQl0ID0gbW9uYWNvLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuQ29sb3I7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkNvbnN0cnVjdG9yIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLkNvbnN0cnVjdG9yOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJFbnVtIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLkVudW07CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkZpZWxkIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLkZpZWxkOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJGaWxlIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLkZpbGU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkZvbGRlciI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5Gb2xkZXI7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkZ1bmN0aW9uIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLkZ1bmN0aW9uOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJJbnRlcmZhY2UiOgoJCQkJCQl0ID0gbW9uYWNvLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuSW50ZXJmYWNlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJLZXl3b3JkIjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQ7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIk1ldGhvZCI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5NZXRob2Q7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIk1vZHVsZSI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5Nb2R1bGU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIlByb3BlcnR5IjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLlByb3BlcnR5OwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJSZWZlcmVuY2UiOgoJCQkJCQl0ID0gbW9uYWNvLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuUmVmZXJlbmNlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJTbmlwcGV0IjoKCQkJCQkJdCA9IG1vbmFjby5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLlNuaXBwZXQ7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIlRleHQiOgoJCQkJCQl0ID0gbW9uYWNvLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuVGV4dDsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiVW5pdCI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5Vbml0OwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJWYWx1ZSI6CgkJCQkJCXQgPSBtb25hY28ubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5WYWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiVmFyaWFibGUiOgoJCQkJCQl0ID0gbW9uYWNvLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuVmFyaWFibGU7CgkJCQkJCWJyZWFrOwoJCQkJfQoKCQkJCVByb3Bvc2Fscy5wdXNoKHsKCQkJCQlsYWJlbDogbCwKCQkJCQlraW5kOiB0LAoJCQkJCWRldGFpbDogZCwKCQkJCQlpbnNlcnRUZXh0OiBpCgkJCQl9KTsKCQkJfQoJCQlhc3luYyBmdW5jdGlvbiBsb2FkKCkgewoJCQkJdmFyIGRvY3MgPSBhd2FpdChhd2FpdCBmZXRjaCgnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0luc2FsYWQvbW9uYWNvc2hpdC9yZWZzL2hlYWRzL21haW4vYmxhaCcpKS5qc29uKCk7CgoJCQkJZm9yICh2YXIgcHJvcCBpbiBkb2NzKSB7CiAgCQkJCQkgIGZvcih2YXIgaXRlbSBpbiBkb2NzW3Byb3BdKQoJCQkJCSAgewoJCQkJCQkgICAgY29uc3QgZG9jdW1lbnQgPSBkb2NzW3Byb3BdW2l0ZW1dOwoJCQkJCQkJQWRkSW50ZWxsaXNlbnNlKGRvY3VtZW50LmxhYmVsLCBkb2N1bWVudC50eXBlLCBkb2N1bWVudC5kZXNjcmlwdGlvbiwgZG9jdW1lbnQuaW5zZXJ0KTsKCQkJCQkgIH0KCQkJCX0KCgkJCQlmb3IgKGNvbnN0IEtleSBvZiBbIl9HIiwgIl9WRVJTSU9OIiwgIkVudW0iLCAiZ2FtZSIsICJwbHVnaW4iLCAic2hhcmVkIiwgInNjcmlwdCIsICJ3b3Jrc3BhY2UiLCAiRGVidWdnZXJNYW5hZ2VyIiwgImVsYXBzZWRUaW1lIiwgIkxvYWRMaWJyYXJ5IiwgIlBsdWdpbk1hbmFnZXIiLCAic2V0dGluZ3MiLCAidGljayIsICJ0aW1lIiwgInR5cGVvZiIsICJVc2VyU2V0dGluZ3MiXSkKICAgICAgICAgICAgICAgICAgICBBZGRJbnRlbGxpc2Vuc2UoS2V5LCAiS2V5d29yZCIsIEtleSwgS2V5KTsKCgkJCQlmb3IgKGNvbnN0IEtleSBvZiBbImFuZCIsICJicmVhayIsICJkbyIsICJlbHNlIiwgImVsc2VpZiIsICJlbmQiLCAiZmFsc2UiLCAiZm9yIiwgImZ1bmN0aW9uIiwgImlmIiwgImluIiwgImxvY2FsIiwgIm5pbCIsICJub3QiLCAib3IiLCAicmVwZWF0IiwgInJldHVybiIsICJ0aGVuIiwgInRydWUiLCAidW50aWwiLCAid2hpbGUiXSkKICAgICAgICAgICAgICAgICAgICBBZGRJbnRlbGxpc2Vuc2UoS2V5LCAiVmFyaWFibGUiLCBLZXksIEtleSk7CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBLZXkgb2YgWyJtYXRoLmFicyIsICJtYXRoLmFjb3MiLCAibWF0aC5hc2luIiwgIm1hdGguYXRhbiIsICJtYXRoLmF0YW4yIiwgIm1hdGguY2VpbCIsICJtYXRoLmNvcyIsICJtYXRoLmNvc2giLCAibWF0aC5kZWciLCAibWF0aC5leHAiLCAibWF0aC5mbG9vciIsICJtYXRoLmZtb2QiLCAibWF0aC5mcmV4cCIsICJtYXRoLmh1Z2UiLCAibWF0aC5sZGV4cCIsICJtYXRoLmxvZyIsICJtYXRoLm1heCIsICJtYXRoLm1pbiIsICJtYXRoLm1vZGYiLCAibWF0aC5waSIsICJtYXRoLnBvdyIsICJtYXRoLnJhZCIsICJtYXRoLnJhbmRvbSIsICJtYXRoLnJhbmRvbXNlZWQiLCAibWF0aC5zaW4iLCAibWF0aC5zaW5oIiwgIm1hdGguc3FydCIsICJtYXRoLnRhbiIsICJtYXRoLnRhbmgiLCAidGFibGUuY29uY2F0IiwgInRhYmxlLmZvcmVhY2giLCAidGFibGUuZm9yZWFjaGkiLCAidGFibGUuc29ydCIsICJ0YWJsZS5pbnNlcnQiLCAidGFibGUucmVtb3ZlIiwgIkNvbG9yMy5uZXciLCAiSW5zdGFuY2UubmV3IiwgIkJyaWNrQ29sb3IubmV3IiwgIlZlY3RvcjMubmV3IiwgIlZlY3RvcjIubmV3IiwgImRlYnVnLmdldGhvb2siLCAiZGVidWcuZ2V0aW5mbyIsICJkZWJ1Zy5nZXRsb2NhbCIsICJkZWJ1Zy5nZXRtZXRhdGFibGUiLCAiZGVidWcuZ2V0cmVnaXN0cnkiLCAiZGVidWcuZ2V0dXB2YWx1ZSIsICJkZWJ1Zy5nZXR1c2VydmFsdWUiLCAiZGVidWcuc2V0aG9vayIsICJkZWJ1Zy5zZXRsb2NhbCIsICJkZWJ1Zy5zZXRtZXRhdGFibGUiLCAiZGVidWcuc2V0dXB2YWx1ZSIsICJkZWJ1Zy5zZXR1c2VydmFsdWUiLCAiZGVidWcudHJhY2ViYWNrIiwgImRlYnVnLnVwdmFsdWVpZCIsICJkZWJ1Zy51cHZhbHVlam9pbiIsICJzdHJpbmcuYnl0ZSIsICJzdHJpbmcuY2hhciIsICJzdHJpbmcuZHVtcCIsICJzdHJpbmcuZmluZCIsICJzdHJpbmcuZm9ybWF0IiwgInN0cmluZy5nbWF0Y2giLCAic3RyaW5nLmdzdWIiLCAic3RyaW5nLmxlbiIsICJzdHJpbmcubG93ZXIiLCAic3RyaW5nLm1hdGNoIiwgInN0cmluZy5yZXAiLCAic3RyaW5nLnJldmVyc2UiLCAic3RyaW5nLnN1YiIsICJzdHJpbmcudXBwZXIiLCAiY29yb3V0aW5lLmNyZWF0ZSIsICJjb3JvdXRpbmUucmVzdW1lIiwgImNvcm91dGluZS5ydW5uaW5nIiwgImNvcm91dGluZS5zdGF0dXMiLCAiY29yb3V0aW5lLndyYXAiLCAiY29yb3V0aW5lLnlpZWxkIl0pCgkJCQkJQWRkSW50ZWxsaXNlbnNlKEtleSwgIk1ldGhvZCIsIEtleSwgS2V5KTsKCgkJCQlmb3IgKGNvbnN0IEtleSBvZiBbIkRyYXdpbmciLCAiZGVidWciLCAiSW5zdGFuY2UiLCAiQ29sb3IzIiwgIlZlY3RvcjMiLCAiVmVjdG9yMiIsICJCcmlja0NvbG9yIiwgIm1hdGgiLCAidGFibGUiLCAic3RyaW5nIiwgImNvcm91dGluZSIsICJIdW1hbm9pZCIsICJDbGlja0RldGVjdG9yIiwgIkxvY2FsU2NyaXB0IiwgIk1vZGVsIiwgIk1vZHVsZVNjcmlwdCIsICJNb3VzZSIsICJQYXJ0IiwgIlBsYXllciIsICJTY3JpcHQiLCAiVG9vbCIsICJSdW5TZXJ2aWNlIiwgIlVzZXJJbnB1dFNlcnZpY2UiLCAiV29ya3NwYWNlIl0pCgkJCQkJQWRkSW50ZWxsaXNlbnNlKEtleSwgIkNsYXNzIiwgS2V5LCBLZXkpOwoKCQkJCWZvciAoY29uc3QgS2V5IG9mIFsicHJpbnQiLCAid2FybiIsICJ3YWl0IiwgImluZm8iLCAicHJpbnRpZGVudGl0eSIsICJhc3NlcnQiLCAiY29sbGVjdGdhcmJhZ2UiLCAiZXJyb3IiLCAiZ2V0ZmVudiIsICJnZXRtZXRhdGFibGUiLCAic2V0bWV0YXRhYmxlIiwgImlwYWlycyIsICJsb2FkZmlsZSIsICJsb2Fkc3RyaW5nIiwgIm5ld3Byb3h5IiwgIm5leHQiLCAicGFpcnMiLCAicGNhbGwiLCAic3Bhd24iLCAicmF3ZXF1YWwiLCAicmF3Z2V0IiwgInJhd3NldCIsICJzZWxlY3QiLCAidG9udW1iZXIiLCAidG9zdHJpbmciLCAidHlwZSIsICJ1bnBhY2siLCAieHBjYWxsIiwgImRlbGF5IiwgInN0YXRzIiwgIjpSZW1vdmUoKSIsICI6QnJlYWtKb2ludHMoKSIsICI6R2V0Q2hpbGRyZW4oKSIsICI6RmluZEZpcnN0Q2hpbGQoKSIsICI6RmlyZVNlcnZlcigpIiwgIjpJbnZva2VTZXJ2ZXIoKSIsICI6Q2xlYXJBbGxDaGlsZHJlbigpIiwgIjpDbG9uZSgpIiwgIjpEZXN0cm95KCkiLCAiOkZpbmRGaXJzdEFuY2VzdG9yKCkiLCAiOkZpbmRGaXJzdEFuY2VzdG9yT2ZDbGFzcygpIiwgIjpGaW5kRmlyc3RBbmNlc3RvcldoaWNoSXNBKCkiLCAiOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygpIiwgIjpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCkiLCAiOkdldERlYnVnSWQoKSIsICI6R2V0RGVzY2VuZGFudHMoKSIsICI6R2V0RnVsbE5hbWUoKSIsICI6SXNBKCkiLCAiOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgpIiwgIjpJc0FuY2VzdG9yT2YoKSIsICI6SXNEZXNjZW5kYW50T2YoKSIsICI6V2FpdEZvckNoaWxkKCkiLCAiOkNvbm5lY3QoKSIsICI6QW5jZXN0cnlDaGFuZ2VkKCkiLCAiOkNoYW5nZWQoKSIsICI6Q2hpbGRBZGRlZCgpIiwgIjpDaGlsZFJlbW92ZWQoKSIsICI6RGVzY2VuZGFudEFkZGVkKCkiLCAiOkRlc2NlbmRhbnRSZW1vdmluZygpIiwgIjpHZXRTZXJ2aWNlKCkiLCAiOkdldE9iamVjdHMoKSIsICI6SHR0cEdldCgpIiwgIjpXYWl0KCkiXSkKICAgICAgICAgICAgICAgICAgICBBZGRJbnRlbGxpc2Vuc2UoS2V5LCAiRnVuY3Rpb24iLCBLZXksIEtleS5pbmNsdWRlcygiOiIpID8gS2V5LnN1YnN0cmluZygxLCBLZXkubGVuZ3RoKSA6IEtleSk7CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBLZXkgb2YgWyJWaXNpYmxlIiwgIkNvbG9yIiwgIlRyYW5zcGFyZW5jeSIsICJUaGlja25lc3MiLCAiRnJvbSIsICJUbyIsICJUZXh0IiwgIlNpemUiLCAiQ2VudGVyIiwgIk91dGxpbmUiLCAiT3V0bGluZUNvbG9yIiwgIlBvc2l0aW9uIiwgIlRleHRCb3VuZHMiLCAiRm9udCIsICJEYXRhIiwgIlJvdW5kaW5nIiwgIk51bVNpZGVzIiwgIlJhZGl1cyIsICJGaWxsZWQiLCAiUG9pbnRBIiwgIlBvaW50QiIsICJQb2ludEMiLCAiUG9pbnREIl0pCgkJCQkJQWRkSW50ZWxsaXNlbnNlKEtleSwgIlByb3BlcnR5IiwgIlByb3BlcnR5IGZvciBEcmF3aW5nIExpYnJhcnkiLCBLZXkpOwoKCQkJfQoJCQlsb2FkKCk7CgkJCVJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CgkJCQl2YXIgdGV4dCA9IEdldFRleHQoKTsKCQkJCVNldFRleHQoIiIpOwoJCQkJZWRpdG9yLnRyaWdnZXIoJ2tleWJvYXJkJywgJ3R5cGUnLCB7CgkJCQkJdGV4dDogdGV4dAoJCQkJfSk7CgkJCX0KCQl9KTsKCTwvc2NyaXB0PgogIDxzY3JpcHQ+CmZldGNoKCd0aGVtZXMudHh0JykKICAudGhlbihyZXMgPT4gcmVzLnRleHQoKSkKICAudGhlbih1cmwgPT4gewogICAgY29uc3QgYmcgPSB1cmwudHJpbSgpOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVkaXRvci1jb250YWluZXInKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCcke2JnfScpYDsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lZGl0b3ItY29udGFpbmVyJykuc3R5bGUuYmFja2dyb3VuZFNpemUgPSAnY292ZXInOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmVkaXRvci1jb250YWluZXInKS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb24gPSAnY2VudGVyJzsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lZGl0b3ItY29udGFpbmVyJykuc3R5bGUuYmFja2dyb3VuZFJlcGVhdCA9ICduby1yZXBlYXQnOwogIH0pCiAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKCdLaMO0bmcgdGjhu4MgdOG6o2kgdGhlbWVzLnR4dDonLCBlcnIpKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg%3D%3D%22%29%29%3B%0A%3C/script%3E"));
//-->
</script>
